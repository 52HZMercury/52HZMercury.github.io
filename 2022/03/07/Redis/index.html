

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/favicon.png">
  <link rel="icon" href="/img/moon.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="Mercury">
  <meta name="keywords" content="">
  
    <meta name="description" content="redis作为一个NoSQL可以作为数据库，缓存或者消息中间件，已经是这个大数据时代的后端程序员所必须要掌握的一项技术了">
<meta property="og:type" content="article">
<meta property="og:title" content="Redis">
<meta property="og:url" content="http://example.com/2022/03/07/Redis/index.html">
<meta property="og:site_name" content="Mercury&#39;s blog">
<meta property="og:description" content="redis作为一个NoSQL可以作为数据库，缓存或者消息中间件，已经是这个大数据时代的后端程序员所必须要掌握的一项技术了">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/52HZMercury/img/blog/mmexport1649953059484.jpg">
<meta property="article:published_time" content="2022-03-07T11:57:14.000Z">
<meta property="article:modified_time" content="2024-11-06T12:51:37.549Z">
<meta property="article:author" content="Mercury">
<meta property="article:tag" content="database">
<meta property="article:tag" content="NoSQL">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/52HZMercury/img/blog/mmexport1649953059484.jpg">
  
  
    <meta name="referrer" content="no-referrer-when-downgrade">
  
  
  <title>Redis - Mercury&#39;s blog</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/KaTeX/0.15.2/katex.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_kmeydafke9r.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"example.com","root":"/","version":"1.9.0","typing":{"enable":true,"typeSpeed":90,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/newloading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml"};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>

  
<meta name="generator" content="Hexo 5.4.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>Mercury</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                首页
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                归档
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                分类
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                标签
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                关于
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/links/">
                <i class="iconfont icon-link-fill"></i>
                友链
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              &nbsp;<i class="iconfont icon-search"></i>&nbsp;
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/Post%20Page.jpg') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="Redis"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2022-03-07 19:57" pubdate>
          2022年3月7日 晚上
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          <!-- compatible with older versions-->
          64k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          <!-- compatible with older versions-->
          200 分钟
        
      </span>
    

    
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">Redis</h1>
            
            <div class="markdown-body">
              
              <p class="note note-success">前言:依据狂神说视频整理</p>
<h2 id="一、Nosql概述">一、Nosql概述</h2>
<h3 id="1、初识Nosql">1、初识Nosql</h3>
<p>为什么会使用Nosql呢？我们现在所处于大数据时代，用户的个人信息，社交网络，地理位置，用户自己产生的数据等，数据量十分的庞大，而一般的数据库无法进行分析处理。当访问量过大后，一个服务器承受不了，当出现这种情况后，于是Nosql便应运而生了，Nosql 的全程是Not only sql 不仅仅是sql，因此，他能做的sql 更多。</p>
<h3 id="2、Nosql的特点">2、Nosql的特点</h3>
<ul>
<li>
<p>方便扩展</p>
</li>
<li>
<p>大数据量的高性能</p>
</li>
<li>
<p>数据类型是多样性的</p>
</li>
</ul>
<p class  = "note note-success">传统RDBMS和Nosql</p>
<p><span class = "label label-primary">传统的RDBMS</span></p>
<ul>
<li>
<p>结构化的组织</p>
</li>
<li>
<p>SQL</p>
</li>
<li>
<p>数据和关系都存在单独的表中</p>
</li>
<li>
<p>数据定义语言</p>
</li>
<li>
<p>严格的一致性</p>
</li>
<li>
<p>基础的事务</p>
</li>
</ul>
<p><span class = "label label-info">Nosql</span></p>
<ul>
<li>不仅仅是数据</li>
<li>没有固定的查询语言</li>
<li>键值对存储，列存储、文档存储、图形数据库</li>
<li>最终一致性</li>
<li>CAP定理和BASE(异地多活)</li>
<li>高性能、高可用、高可扩</li>
<li></li>
</ul>
<h3 id="3、3V-3高">3、3V+3高</h3>
<p>大数据时代的3V：主要是描述问题的<br>
1、海量的Volume<br>
2、多样的Variety<br>
3、实时的Velocity<br>
大数据时代的3高：主要是对程序的要求<br>
1、高并发<br>
2、高可拓<br>
3、高性能</p>
<h3 id="4、Nosql的四大分类">4、Nosql的四大分类</h3>
<ul>
<li>
<p>KV键值对    例如：redis</p>
</li>
<li>
<p>文档型数据库 例如：MongoDB</p>
</li>
<li>
<p>列存储数据库 例如：Hbase</p>
</li>
<li>
<p>图关系型数据库 例如 ：Neo4j</p>
</li>
</ul>
<h2 id="二、Redis入门">二、Redis入门</h2>
<h3 id="1、概述">1、概述</h3>
<p>Redis全称remote dictionary server 远程字典服务，是一个使用C语言编写、支持网络、可基于内存亦可持久化的日志型key-Value数据库，并提供了多种语言的API。Redis 是一个开源的，内存中的数据结构存储系统，它可以用作数据库、缓存和消息中间件。 它支持多种类型的数据结构，如 字符串（strings）， 散列（hashes）， 列表（lists）， 集合（sets）， 有序集合（sorted sets） 与范围查询， bitmaps， hyperloglogs 和 地理空间（geospatial） 索引半径查询。 Redis 内置了 复制（replication），LUA脚本（Lua scripting）， LRU驱动事件（LRU eviction），事务（transactions） 和不同级别的 磁盘持久化（persistence）， 并通过 Redis哨兵（Sentinel）和自动分区（Cluster）提供高可用性（high availability）。</p>
<p>链接: <a target="_blank" rel="noopener" href="https://redis.io/">redis官网</a>  | <a target="_blank" rel="noopener" href="https://github.com/redis">GitHub上的开源地址</a></p>
<p>不建议windows ，windows端的github上面已经停更很久了，redis推荐linux</p>
<p><img src="https://cdn.jsdelivr.net/gh/52HZMercury/img/blog/image-20241106153635577.png" srcset="/img/newloading.gif" lazyload alt="image-20241106153635577"></p>
<h3 id="2、安装">2、安装</h3>
<p>CSDN上面有很多教程，这里不再赘述</p>
<h2 id="三、基本指令">三、基本指令</h2>
<p>启动redis</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">../redis-server redis.conf  //启动服务端<br>redis-cli  //进入客户端<br></code></pre></td></tr></table></figure>
<h3 id="1、切换数据库">1、切换数据库</h3>
<p>redis 默认有16个数据库</p>
<p>可以使用select进行切换数据库</p>
<figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs accesslog"><span class="hljs-number">127.0.0.1:6379</span>&gt; select <span class="hljs-number">3</span>                 # 切换数据库<br><br>OK<br><br><span class="hljs-number">127.0.0.1:6379</span><span class="hljs-string">[3]</span>&gt; dbsize                #查看数据库所占的大小 <br><br>(integer) <span class="hljs-number">0</span><br><br><span class="hljs-number">127.0.0.1:6379</span><span class="hljs-string">[3]</span>&gt;<br></code></pre></td></tr></table></figure>
<h3 id="2、set和get">2、set和get</h3>
<p>因为是key-vakue类型的数据库。所以需要使用set和get来进行操作</p>
<figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs accesslog"><span class="hljs-number">127.0.0.1:6379</span><span class="hljs-string">[3]</span>&gt;set name chenning      #set key value<br><br>OK<br><br><span class="hljs-number">127.0.0.1:6379</span><span class="hljs-string">[3]</span>&gt; get name<br><br><span class="hljs-string">&quot;chenning&quot;</span><br></code></pre></td></tr></table></figure>
<h3 id="3、查看所有键值">3、查看所有键值</h3>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">127</span>.<span class="hljs-number">0</span>.<span class="hljs-number">0</span>.<span class="hljs-number">1</span>:<span class="hljs-number">6379</span>[<span class="hljs-number">3</span>]&gt;keys *<br><br><span class="hljs-attribute">1</span>) <span class="hljs-string">&quot;name&quot;</span><br></code></pre></td></tr></table></figure>
<h3 id="4、清除">4、清除</h3>
<figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs accesslog"><span class="hljs-number">127.0.0.1:6379</span><span class="hljs-string">[3]</span>&gt;flushdb               # 清除当前数据库的数据<br><br>OK<br><br><span class="hljs-number">127.0.0.1:6379</span><span class="hljs-string">[3]</span>&gt; keys *<br><br>(empty array)<br><br><span class="hljs-number">127.0.0.1:6379</span>&gt; flushall                #清空所有数据库的数据<br><br>OK<br></code></pre></td></tr></table></figure>
<p><strong>补充说明：</strong></p>
<p>redis是单线程的 redis是基于内存操作的，cpu不是redis的性能瓶颈 redis的瓶颈是根据机器的内存和网络带宽，既然可以使用单线程 于是就用了单线程</p>
<blockquote>
<p>为什么单线程还这么快?</p>
</blockquote>
<ul>
<li>
<p>误区一 高性能的服务器一定 是多线程的</p>
</li>
<li>
<p>误区二 多线程的一定比单线程的效率高</p>
</li>
</ul>
<p>redis是将所有的数据放在内存中的所有说使用单线程去擦欧总就是最高的 多线程cpu会上下文切换 对于内存系统来说，没有上下文的切换效率就是最高的，在内存情况下，单线程就是效率最高的方案</p>
<h2 id="四、Redis入门">四、Redis入门</h2>
<h3 id="1、key-相关指令">1、key 相关指令</h3>
<h4 id="1-1-查看是否拥有key">1.1 查看是否拥有key</h4>
<figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs accesslog"><span class="hljs-number">127.0.0.1:6379</span>&gt; exists name                        #查看是否拥有 name这个键<br><br>(integer) <span class="hljs-number">1</span>                                        #拥有则返回<span class="hljs-number">1</span><br><br><span class="hljs-number">127.0.0.1:6379</span>&gt; exists name1<br><br>(integer) <span class="hljs-number">0</span>                                        #不拥有则返回<span class="hljs-number">0</span><br></code></pre></td></tr></table></figure>
<h4 id="1-2、移动key">1.2、移动key</h4>
<figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs accesslog"><span class="hljs-number">127.0.0.1:6379</span>&gt; move name <span class="hljs-number">1</span>                        #move key db  将key移动到对应的数据库<br><br>(integer) <span class="hljs-number">1</span><br><br><span class="hljs-number">127.0.0.1:6379</span>&gt; keys *<br><br>(empty array)<br></code></pre></td></tr></table></figure>
<h4 id="1-3、查看key值是否存在">1.3、查看key值是否存在</h4>
<figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs accesslog"><span class="hljs-number">127.0.0.1:6379</span>&gt; exists name                        #查看name这个key在这里存在吗<br><br>(integer) <span class="hljs-number">1</span>                                        #存在<br><br><span class="hljs-number">127.0.0.1:6379</span>&gt; exists name1<br><br>(integer) <span class="hljs-number">0</span>                                        #不存在<br><br><br></code></pre></td></tr></table></figure>
<h4 id="1-4、设置存活时间">1.4、设置存活时间</h4>
<figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs accesslog"><br><span class="hljs-number">127.0.0.1:6379</span>&gt; set name chenning<br><br>OK<br><br><span class="hljs-number">127.0.0.1:6379</span>&gt; expire name <span class="hljs-number">10</span>                    # 设置存活时间为<span class="hljs-number">10</span>秒<br><br>(integer) <span class="hljs-number">1</span><br><br><span class="hljs-number">127.0.0.1:6379</span>&gt; ttl name                          # 查看剩余的时间<br><br>(integer) <span class="hljs-number">5</span>                                       #还剩<span class="hljs-number">5</span>秒<br><br><span class="hljs-number">127.0.0.1:6379</span>&gt; ttl name <br><br>(integer) -<span class="hljs-number">2</span>                                      #已经过期<br><br><span class="hljs-number">127.0.0.1:6379</span>&gt; get name <br><br>(nil)                                             #值已经无法获取<br><br></code></pre></td></tr></table></figure>
<h4 id="1-5、查看value的类型">1.5、查看value的类型</h4>
<figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs accesslog"><span class="hljs-number">127.0.0.1:6379</span>&gt; set name chenning<br><br>OK<br><br><span class="hljs-number">127.0.0.1:6379</span>&gt; type name                        #查看value的类型<br><br>string<br></code></pre></td></tr></table></figure>
<h3 id="2、String">2、String</h3>
<h4 id="2-1、追加">2.1、追加</h4>
<figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs accesslog"><span class="hljs-number">127.0.0.1:6379</span>&gt; get name<br><br><span class="hljs-string">&quot;chenning&quot;</span><br><br><span class="hljs-number">127.0.0.1:6379</span>&gt; append name <span class="hljs-string">&quot;niubi&quot;</span>              #追加 如果没有的话就会新建<br><br>(integer) <span class="hljs-number">13</span>                                     #这里返回的是字符串的长度<br><br><span class="hljs-number">127.0.0.1:6379</span>&gt; get name<br><br><span class="hljs-string">&quot;chenningniubi&quot;</span><br></code></pre></td></tr></table></figure>
<h4 id="2-2、查询长度">2.2、查询长度</h4>
<figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs accesslog"><span class="hljs-number">127.0.0.1:6379</span>&gt; strlen name<br><br>(integer) <span class="hljs-number">13</span><br></code></pre></td></tr></table></figure>
<h4 id="2-3、自增和自减">2.3、自增和自减</h4>
<figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs accesslog"><span class="hljs-number">127.0.0.1:6379</span>&gt; set views <span class="hljs-number">0</span><br><br>OK<br><br><span class="hljs-number">127.0.0.1:6379</span>&gt; get views<br><br><span class="hljs-string">&quot;0&quot;</span><br><br><span class="hljs-number">127.0.0.1:6379</span>&gt; incr views             # 增加 <span class="hljs-number">1</span><br><br>(integer) <span class="hljs-number">1</span><br><br><span class="hljs-number">127.0.0.1:6379</span>&gt; incr views<br><br>(integer) <span class="hljs-number">2</span><br><br><span class="hljs-number">127.0.0.1:6379</span>&gt; decr views             # 减少 <span class="hljs-number">1</span><br><br>(integer) <span class="hljs-number">1</span><br><br><span class="hljs-number">127.0.0.1:6379</span>&gt; decr views<br><br>(integer) <span class="hljs-number">0</span><br></code></pre></td></tr></table></figure>
<p>增加和减少的时候是可以设置步长的</p>
<figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs accesslog"><span class="hljs-number">127.0.0.1:6379</span>&gt; incrby views <span class="hljs-number">10</span>        # 设置步长为<span class="hljs-number">10</span>  一次增加<span class="hljs-number">10</span><br><br>(integer) <span class="hljs-number">12</span><br><br><span class="hljs-number">127.0.0.1:6379</span>&gt; decrby views <span class="hljs-number">4</span>         # 设置步长为<span class="hljs-number">4</span>  一次减少<span class="hljs-number">4</span><br><br>(integer) <span class="hljs-number">8</span><br></code></pre></td></tr></table></figure>
<h4 id="2-4、截取字符串">2.4、截取字符串</h4>
<figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs accesslog"><span class="hljs-number">127.0.0.1:6379</span>&gt; getrange name <span class="hljs-number">0</span> <span class="hljs-number">3</span>      #截取 <span class="hljs-number">0</span> 到 <span class="hljs-number">3</span> 位置的字符串<br><br><span class="hljs-string">&quot;chen&quot;</span><br><br><span class="hljs-number">127.0.0.1:6379</span>&gt; getrange name <span class="hljs-number">0</span> -<span class="hljs-number">1</span>     #获取全部的额字符串<br><br><span class="hljs-string">&quot;chenningniubi&quot;</span><br></code></pre></td></tr></table></figure>
<h4 id="2-5、替代字符串">2.5、替代字符串</h4>
<figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs accesslog"><span class="hljs-number">127.0.0.1:6379</span>&gt; SETRANGE name <span class="hljs-number">1</span> xx     #将<span class="hljs-number">1</span>后的部分字符串替换为xx<br><br>(integer) <span class="hljs-number">13</span><br><br><span class="hljs-number">127.0.0.1:6379</span>&gt; get name <br><br><span class="hljs-string">&quot;cxxnningniubi&quot;</span>                        # 结果<br></code></pre></td></tr></table></figure>
<h4 id="2-6、设置有存活时间的字符串">2.6、设置有存活时间的字符串</h4>
<figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs accesslog"><span class="hljs-number">127.0.0.1:6379</span>&gt; SETEX yy2 <span class="hljs-number">30</span> <span class="hljs-string">&quot;hello&quot;</span>   #setex key time string<br><br>OK<br><br><span class="hljs-number">127.0.0.1:6379</span>&gt; ttl yy2 <br><br>(integer) <span class="hljs-number">23</span><br><br><span class="hljs-number">127.0.0.1:6379</span>&gt; ttl yy2 <br><br>(integer) <span class="hljs-number">17</span><br><br><span class="hljs-number">127.0.0.1:6379</span>&gt; ttl yy2 <br><br>(integer) <span class="hljs-number">1</span><br><br><span class="hljs-number">127.0.0.1:6379</span>&gt; ttl yy2 <br><br>(integer) -<span class="hljs-number">2</span>                           #已过期<br></code></pre></td></tr></table></figure>
<h4 id="2-7、设置不存在的key">2.7、设置不存在的key</h4>
<figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs accesslog"><span class="hljs-number">127.0.0.1:6379</span>&gt; SETNX mykey <span class="hljs-string">&quot;db&quot;</span><br><br>(integer) <span class="hljs-number">1</span><br><br><span class="hljs-number">127.0.0.1:6379</span>&gt; SETNX mykey <span class="hljs-string">&quot;mdu&quot;</span>      #如果key已经存在，则不会做出修改，返回<span class="hljs-number">0</span>失败<br><br>(integer) <span class="hljs-number">0</span><br><br><span class="hljs-number">127.0.0.1:6379</span>&gt;get mykey<br><br><span class="hljs-string">&quot;db&quot;</span>                                   #依旧还是原来的值<br></code></pre></td></tr></table></figure>
<h4 id="2-8、批量操作key和value">2.8、批量操作key和value</h4>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">127</span>.<span class="hljs-number">0</span>.<span class="hljs-number">0</span>.<span class="hljs-number">1</span>:<span class="hljs-number">6379</span>&gt; mset k<span class="hljs-number">1</span> v<span class="hljs-number">1</span> k<span class="hljs-number">2</span> v<span class="hljs-number">3</span> k<span class="hljs-number">3</span> v<span class="hljs-number">3</span>   #使用 mset 操作，一个key后面跟随一个value值<br><br><span class="hljs-attribute">OK</span><br><br><span class="hljs-attribute">127</span>.<span class="hljs-number">0</span>.<span class="hljs-number">0</span>.<span class="hljs-number">1</span>:<span class="hljs-number">6379</span>&gt; mget k<span class="hljs-number">1</span> k<span class="hljs-number">2</span> k<span class="hljs-number">3</span>            #批量获取key的值<br><br><span class="hljs-attribute">1</span>) <span class="hljs-string">&quot;v1&quot;</span><br><br><span class="hljs-attribute">2</span>) <span class="hljs-string">&quot;v3&quot;</span><br><br><span class="hljs-attribute">3</span>) <span class="hljs-string">&quot;v3</span><br></code></pre></td></tr></table></figure>
<figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs accesslog"><span class="hljs-number">127.0.0.1:6379</span>&gt; MSETNX k1 v1 k4 v4       #这里的 msetnx 和上面的是一样的操作，需要注意的就是，<br>                                         #这里是原子性操作，要么一起成功 要么一起失败，例如这里因为设置过k1所以失败了<br>(integer) <span class="hljs-number">0</span><br><br></code></pre></td></tr></table></figure>
<h4 id="2-9、设置对象">2.9、设置对象</h4>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">set</span> <span class="hljs-keyword">user</span>:<span class="hljs-number">1</span> &#123;<span class="hljs-type">name</span>:zhangsan,age:<span class="hljs-number">3</span>&#125;         #设置一个<span class="hljs-type">json</span>字符串来保存对象<br></code></pre></td></tr></table></figure>
<p>或者有更巧妙的设计</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">127</span>.<span class="hljs-number">0</span>.<span class="hljs-number">0</span>.<span class="hljs-number">1</span>:<span class="hljs-number">6379</span>&gt; mset user:<span class="hljs-number">1</span>:name zhangsan user:<span class="hljs-number">1</span>:age <span class="hljs-number">2</span><br><br><span class="hljs-attribute">ok</span><br><br><span class="hljs-attribute">127</span>.<span class="hljs-number">0</span>.<span class="hljs-number">0</span>.<span class="hljs-number">1</span>:<span class="hljs-number">6379</span>&gt; mget user:<span class="hljs-number">1</span>:name  user:<span class="hljs-number">1</span>:age <br><br><span class="hljs-attribute">1</span>) <span class="hljs-string">&quot;zhangsan&quot;</span><br><span class="hljs-attribute">2</span>) <span class="hljs-string">&quot;2&quot;</span><br></code></pre></td></tr></table></figure>
<h4 id="2-10、getset">2.10、getset</h4>
<figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs accesslog"><span class="hljs-number">127.0.0.1:6379</span>&gt; getset db redis    # 如果不存在，则返回 nil<br>(nil)<br><span class="hljs-number">127.0.0.1:6379</span>&gt; get db<br><span class="hljs-string">&quot;redis&quot;</span><br><span class="hljs-number">127.0.0.1:6379</span>&gt; getset db mongodb  #如果存在值，获取原来的值，并设置新的值<br><span class="hljs-string">&quot;redis&quot;</span><br><span class="hljs-number">127.0.0.1:6379</span>&gt; get db<br><span class="hljs-string">&quot;mongodb &quot;</span><br></code></pre></td></tr></table></figure>
<h3 id="3、List">3、List</h3>
<p>所有的List命令都是L开头的</p>
<h4 id="3-1、push">3.1、push</h4>
<p>像队列一样增加</p>
<figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs accesslog"><span class="hljs-number">127.0.0.1:6379</span>&gt; LPUSH list one               #在左边增加one<br><br>(integer) <span class="hljs-number">1</span><br><br><span class="hljs-number">127.0.0.1:6379</span>&gt; LPUSH list two <br><br>(integer) <span class="hljs-number">2</span><br><br><span class="hljs-number">127.0.0.1:6379</span>&gt; LPUSH list three<br><br>(integer) <span class="hljs-number">3</span><br><br><span class="hljs-number">127.0.0.1:6379</span>&gt; LRANGE list <span class="hljs-number">0</span> -<span class="hljs-number">1</span>             #查看list全部的信息<br><br><span class="hljs-number">1</span>) <span class="hljs-string">&quot;three&quot;</span><br><br><span class="hljs-number">2</span>) <span class="hljs-string">&quot;two&quot;</span><br><br><span class="hljs-number">3</span>) <span class="hljs-string">&quot;one&quot;</span><br><br><span class="hljs-number">127.0.0.1:6379</span>&gt; LRANGE list <span class="hljs-number">0</span> <span class="hljs-number">1</span>              #查看list位置 <span class="hljs-number">0</span> 到 <span class="hljs-number">1</span> 的信息<br><br><span class="hljs-number">1</span>) <span class="hljs-string">&quot;three&quot;</span><br><br><span class="hljs-number">2</span>) <span class="hljs-string">&quot;two&quot;</span><br><br><br></code></pre></td></tr></table></figure>
<p>从右边push</p>
<figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs accesslog"><br><span class="hljs-number">127.0.0.1:6379</span>&gt; RPUSH list four<br><br>(integer) <span class="hljs-number">4</span><br><br><span class="hljs-number">127.0.0.1:6379</span>&gt; LRANGE list <span class="hljs-number">0</span> -<span class="hljs-number">1</span><br><br><span class="hljs-number">1</span>) <span class="hljs-string">&quot;three&quot;</span><br><br><span class="hljs-number">2</span>) <span class="hljs-string">&quot;two&quot;</span><br><br><span class="hljs-number">3</span>) <span class="hljs-string">&quot;one&quot;</span><br><br><span class="hljs-number">4</span>) <span class="hljs-string">&quot;four&quot;</span>                                       #可以看到从右边push后这个four是在最后边的<br></code></pre></td></tr></table></figure>
<h4 id="3-2、-pop">3.2、 pop</h4>
<figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs accesslog"><span class="hljs-number">127.0.0.1:6379</span>&gt; RPOP list                       #从右边pop一个数据出来<br><br><span class="hljs-string">&quot;four&quot;</span><br><br><span class="hljs-number">127.0.0.1:6379</span>&gt; LRANGE list <span class="hljs-number">0</span> -<span class="hljs-number">1</span><br><br><span class="hljs-number">1</span>) <span class="hljs-string">&quot;three&quot;</span><br><br><span class="hljs-number">2</span>) <span class="hljs-string">&quot;two&quot;</span><br><br><span class="hljs-number">3</span>) <span class="hljs-string">&quot;one&quot;</span><br></code></pre></td></tr></table></figure>
<h4 id="3-3、根据下标获取值">3.3、根据下标获取值</h4>
<figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs accesslog"><span class="hljs-number">127.0.0.1:6379</span>&gt; LINDEX list <span class="hljs-number">1</span><br><br><span class="hljs-string">&quot;two&quot;</span><br><br><span class="hljs-number">127.0.0.1:6379</span>&gt; LINDEX list <span class="hljs-number">0</span><br><br><span class="hljs-string">&quot;three&quot;</span><br></code></pre></td></tr></table></figure>
<h4 id="3-4、获取长度">3.4、获取长度</h4>
<figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs accesslog"><span class="hljs-number">127.0.0.1:6379</span>&gt; LLEN list<br><br>(integer) <span class="hljs-number">3</span><br></code></pre></td></tr></table></figure>
<h4 id="3-5、删除指定的元素">3.5、删除指定的元素</h4>
<figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs accesslog"><br><span class="hljs-number">127.0.0.1:6379</span>&gt; lrem list <span class="hljs-number">1</span> three               #从list里面删除一个three,<br><br>(integer) <span class="hljs-number">1</span><br><br><span class="hljs-number">127.0.0.1:6379</span>&gt; LRANGE list <span class="hljs-number">0</span> -<span class="hljs-number">1</span>                #可以看到list里面仍然还有一个three<br><br><span class="hljs-number">1</span>) <span class="hljs-string">&quot;three&quot;</span><br><br><span class="hljs-number">2</span>) <span class="hljs-string">&quot;two&quot;</span><br><br><span class="hljs-number">3</span>) <span class="hljs-string">&quot;one&quot;</span><br></code></pre></td></tr></table></figure>
<h4 id="3-6、修建枝叶">3.6、修建枝叶</h4>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs apache"><br><span class="hljs-attribute">127</span>.<span class="hljs-number">0</span>.<span class="hljs-number">0</span>.<span class="hljs-number">1</span>:<span class="hljs-number">6379</span>&gt; ltrim list <span class="hljs-number">1</span> <span class="hljs-number">2</span>                  #只保留list 里面 <span class="hljs-number">1</span> 到 <span class="hljs-number">2</span> 的元素    list是从<span class="hljs-number">0</span>开始的<br><br><span class="hljs-attribute">OK</span><br><br><span class="hljs-attribute">127</span>.<span class="hljs-number">0</span>.<span class="hljs-number">0</span>.<span class="hljs-number">1</span>:<span class="hljs-number">6379</span>&gt; LRANGE list <span class="hljs-number">0</span> -<span class="hljs-number">1</span>  <br><br><span class="hljs-attribute">1</span>) <span class="hljs-string">&quot;two&quot;</span><br><br><span class="hljs-attribute">2</span>) <span class="hljs-string">&quot;one&quot;</span>                                         #已经是修改过的了<br></code></pre></td></tr></table></figure>
<h4 id="3-7、组合命令">3.7、组合命令</h4>
<figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs accesslog"><br><span class="hljs-number">127.0.0.1:6379</span>&gt; LRANGE list <span class="hljs-number">0</span> -<span class="hljs-number">1</span><br><br><span class="hljs-number">1</span>) <span class="hljs-string">&quot;two&quot;</span><br><br><span class="hljs-number">2</span>) <span class="hljs-string">&quot;one&quot;</span><br><br><span class="hljs-number">127.0.0.1:6379</span>&gt; RPOPLPUSH list otherlist                       # 使右边的元素弹出并push到otherlist<br><br><span class="hljs-string">&quot;one&quot;</span><br><br><span class="hljs-number">127.0.0.1:6379</span>&gt; LRANGE list <span class="hljs-number">0</span> -<span class="hljs-number">1</span><br><br><span class="hljs-number">1</span>) <span class="hljs-string">&quot;two&quot;</span><br><br><span class="hljs-number">127.0.0.1:6379</span>&gt; LRANGE otherlist <span class="hljs-number">0</span> -<span class="hljs-number">1</span><br><br><span class="hljs-number">1</span>) <span class="hljs-string">&quot;one&quot;</span>                                                        <br></code></pre></td></tr></table></figure>
<h4 id="3-8、Lset更新操作">3.8、Lset更新操作</h4>
<figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs accesslog"><span class="hljs-number">127.0.0.1:6379</span>&gt; LSET list <span class="hljs-number">1</span> item        #将list中的 <span class="hljs-number">1</span> 号元素改为item<br><br>(error) ERR index out of range          #不存在则会报错<br><br><span class="hljs-number">127.0.0.1:6379</span>&gt; lset list <span class="hljs-number">0</span> item<br><br>OK<br><br><span class="hljs-number">127.0.0.1:6379</span>&gt; LRANGE list <span class="hljs-number">0</span> -<span class="hljs-number">1</span><br><br><span class="hljs-number">1</span>) <span class="hljs-string">&quot;item&quot;</span>                               #已经成功的变成了item<br><br>                                        #相当于是一个更新操作，如果不存在则会报错<br></code></pre></td></tr></table></figure>
<h4 id="3-9、insert插入操作">3.9、insert插入操作</h4>
<figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs accesslog"><span class="hljs-number">127.0.0.1:6379</span>&gt; RPUSH mylist hello<br><br>(integer) <span class="hljs-number">1</span><br><br><span class="hljs-number">127.0.0.1:6379</span>&gt; RPUSH mylist world<br><br>(integer) <span class="hljs-number">2</span><br><br><span class="hljs-number">127.0.0.1:6379</span>&gt; LINSERT mylist before world niubi          #往world前面插入niubi<br><br>(integer) <span class="hljs-number">3</span><br><br><span class="hljs-number">127.0.0.1:6379</span>&gt; LRANGE mylist <span class="hljs-number">0</span> -<span class="hljs-number">1</span><br><br><span class="hljs-number">1</span>) <span class="hljs-string">&quot;hello&quot;</span><br><br><span class="hljs-number">2</span>) <span class="hljs-string">&quot;niubi&quot;</span><br><br><span class="hljs-number">3</span>) <span class="hljs-string">&quot;world&quot;</span><br><br><span class="hljs-number">127.0.0.1:6379</span>&gt; LINSERT mylist after world gan             #往world后面插入gan<br><br>(integer) <span class="hljs-number">4</span><br><br><span class="hljs-number">127.0.0.1:6379</span>&gt; LRANGE mylist <span class="hljs-number">0</span> -<span class="hljs-number">1</span><br><br><span class="hljs-number">1</span>) <span class="hljs-string">&quot;hello&quot;</span><br><br><span class="hljs-number">2</span>) <span class="hljs-string">&quot;niubi&quot;</span><br><br><span class="hljs-number">3</span>) <span class="hljs-string">&quot;world&quot;</span><br><br><span class="hljs-number">4</span>) <span class="hljs-string">&quot;gan&quot;</span><br></code></pre></td></tr></table></figure>
<h3 id="4、Set">4、Set</h3>
<p>set命令都是S开头，存储的元素不可以重复</p>
<h4 id="4-1、添加元素和查看元素">4.1、添加元素和查看元素</h4>
<figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs accesslog"><span class="hljs-number">127.0.0.1:6379</span>&gt; sadd myset <span class="hljs-string">&quot;hello&quot;</span>        # 往set里面添加元素<br><br>(integer) <span class="hljs-number">1</span><br><br><span class="hljs-number">127.0.0.1:6379</span>&gt; sadd myset <span class="hljs-string">&quot;world&quot;</span><br><br>(integer) <span class="hljs-number">1</span><br><br><span class="hljs-number">127.0.0.1:6379</span>&gt; SMEMBERS myset            #查看所有的元素    <br><br><span class="hljs-number">1</span>) <span class="hljs-string">&quot;world&quot;</span><br><br><span class="hljs-number">2</span>) <span class="hljs-string">&quot;hello&quot;</span><br><br><span class="hljs-number">127.0.0.1:6379</span>&gt; SISMEMBER myset hello     #查看该元素是否在set中<br><br>(integer) <span class="hljs-number">1</span>                               #含有该元素<br><br></code></pre></td></tr></table></figure>
<h4 id="4-2、查询set的长度">4.2、查询set的长度</h4>
<figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs accesslog"><span class="hljs-number">127.0.0.1:6379</span>&gt; SCARD myset<br><br>(integer) <span class="hljs-number">2</span>                               #含有两个元素<br></code></pre></td></tr></table></figure>
<h4 id="4-3、移除元素">4.3、移除元素</h4>
<figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs accesslog"><span class="hljs-number">127.0.0.1:6379</span>&gt; SREM myset hello          #remove指定元素<br><br>(integer) <span class="hljs-number">1</span><br><br><span class="hljs-number">127.0.0.1:6379</span>&gt; SMEMBERS myset<br><br><span class="hljs-number">1</span>) <span class="hljs-string">&quot;world&quot;</span><br><br></code></pre></td></tr></table></figure>
<h4 id="4-4、抽随机">4.4、抽随机</h4>
<figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs accesslog"><span class="hljs-number">127.0.0.1:6379</span>&gt; SRANDMEMBER myset         # 从set里面随机抽取一个元素出来<br><br><span class="hljs-string">&quot;world&quot;</span><br><br><span class="hljs-number">127.0.0.1:6379</span>&gt; SRANDMEMBER myset<br><br><span class="hljs-string">&quot;william&quot;</span><br><br><span class="hljs-number">127.0.0.1:6379</span>&gt; SRANDMEMBER myset<br><br><span class="hljs-string">&quot;world&quot;</span><br></code></pre></td></tr></table></figure>
<h4 id="4-5、随机移除-弹出-一个元素">4.5、随机移除(弹出)一个元素</h4>
<figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs accesslog"><span class="hljs-number">127.0.0.1:6379</span>&gt; SPOP myset                #经典的pop   <br><br><span class="hljs-string">&quot;world&quot;</span><br><br><span class="hljs-number">127.0.0.1:6379</span>&gt; SPOP myset<br><br><span class="hljs-string">&quot;hello&quot;</span><br></code></pre></td></tr></table></figure>
<h4 id="4-6、将一个元素转移到另外一个set">4.6、将一个元素转移到另外一个set</h4>
<figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs accesslog"><span class="hljs-number">127.0.0.1:6379</span>&gt; SMOVE myset myset2 hello        # 组合命令 将hello元素从myset转移到myset2<br><br>(integer) <span class="hljs-number">1</span><br><br><span class="hljs-number">127.0.0.1:6379</span>&gt; SMEMBERS myset<br><br><span class="hljs-number">1</span>) <span class="hljs-string">&quot;world&quot;</span><br><br><span class="hljs-number">2</span>) <span class="hljs-string">&quot;william&quot;</span><br><br><span class="hljs-number">127.0.0.1:6379</span>&gt; SMEMBERS myset2<br><br><span class="hljs-number">1</span>) <span class="hljs-string">&quot;hello&quot;</span><br></code></pre></td></tr></table></figure>
<h4 id="4-7、差，交，并集">4.7、差，交，并集</h4>
<figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs accesslog"><br><span class="hljs-number">127.0.0.1:6379</span>&gt; sadd myset a<br><br>(integer) <span class="hljs-number">1</span><br><br><span class="hljs-number">127.0.0.1:6379</span>&gt; sadd myset b<br><br>(integer) <span class="hljs-number">1</span><br><br><span class="hljs-number">127.0.0.1:6379</span>&gt; sadd myset1 b<br><br>(integer) <span class="hljs-number">1</span><br><br><span class="hljs-number">127.0.0.1:6379</span>&gt; sadd myset1 c<br><br>(integer) <span class="hljs-number">1</span><br><br><span class="hljs-number">127.0.0.1:6379</span>&gt; SDIFF myset myset1          #查询 myset之于myset1的差集<br><br><span class="hljs-number">1</span>) <span class="hljs-string">&quot;a&quot;</span><br><br><span class="hljs-number">127.0.0.1:6379</span>&gt; SINTER myset myset1         #查询 myset和myset1的交集<br><br><span class="hljs-number">1</span>) <span class="hljs-string">&quot;b&quot;</span><br><br><span class="hljs-number">127.0.0.1:6379</span>&gt; SUNION myset myset1         #查询 myset和myset1的并集<br><br><span class="hljs-number">1</span>) <span class="hljs-string">&quot;c&quot;</span><br><br><span class="hljs-number">2</span>) <span class="hljs-string">&quot;a&quot;</span><br><br><span class="hljs-number">3</span>) <span class="hljs-string">&quot;b&quot;</span><br><br><span class="hljs-number">127.0.0.1:6379</span>&gt; SDIFF myset1 myset          #查询 myset1之于myset的差集<br><br><span class="hljs-number">1</span>) <span class="hljs-string">&quot;c&quot;</span><br><br></code></pre></td></tr></table></figure>
<h3 id="5、hash">5、hash</h3>
<p>map集合 key-map</p>
<h4 id="5-1、增加和获取元素">5.1、增加和获取元素</h4>
<figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs accesslog"><span class="hljs-number">127.0.0.1:6379</span>&gt; hset myhash field1 chenning          #在myhash中增加 field1 -- chenning 这一对键值对 <br><br>(integer) <span class="hljs-number">1</span><br><br><span class="hljs-number">127.0.0.1:6379</span>&gt; hget myhash field1                   # 在myhash中查询fields所对应的值<br><br><span class="hljs-string">&quot;chenning&quot;</span><br><br><span class="hljs-number">127.0.0.1:6379</span>&gt; hmset myhash field1 hello field2 world   #批量设置myhash 中的key--value<br><br>OK<br><br><span class="hljs-number">127.0.0.1:6379</span>&gt; hmget myhash field1 field2            #批量获取 myhash 中的key所对应的value<br><br><span class="hljs-number">1</span>) <span class="hljs-string">&quot;hello&quot;</span><br><br><span class="hljs-number">2</span>) <span class="hljs-string">&quot;world&quot;</span><br><br><span class="hljs-number">127.0.0.1:6379</span>&gt; hgetall myhash                        #获取所有的key和value<br><br><span class="hljs-number">1</span>) <span class="hljs-string">&quot;field1&quot;</span><br><br><span class="hljs-number">2</span>) <span class="hljs-string">&quot;hello&quot;</span><br><br><span class="hljs-number">3</span>) <span class="hljs-string">&quot;field2&quot;</span><br><br><span class="hljs-number">4</span>) <span class="hljs-string">&quot;world&quot;</span><br></code></pre></td></tr></table></figure>
<h4 id="5-2、删除元素">5.2、删除元素</h4>
<figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs accesslog"><span class="hljs-number">127.0.0.1:6379</span>&gt; hdel myhash field1                    #删除 myhash 中该 key 所对应的 value<br><br>(integer) <span class="hljs-number">1</span><br><br><span class="hljs-number">127.0.0.1:6379</span>&gt; hgetall myhash<br><br><span class="hljs-number">1</span>) <span class="hljs-string">&quot;field2&quot;</span><br><br><span class="hljs-number">2</span>) <span class="hljs-string">&quot;world&quot;</span><br></code></pre></td></tr></table></figure>
<h4 id="5-3、查询hash的长度">5.3、查询hash的长度</h4>
<figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs accesslog"><span class="hljs-number">127.0.0.1:6379</span>&gt; hlen myhash<br><br>(integer) <span class="hljs-number">1</span><br></code></pre></td></tr></table></figure>
<h4 id="5-4、查询是否存在对应的key">5.4、查询是否存在对应的key</h4>
<figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs accesslog"><span class="hljs-number">127.0.0.1:6379</span>&gt; HEXISTS myhash field1                #经典的 exists 命令<br><br>(integer) <span class="hljs-number">0</span><br><br><span class="hljs-number">127.0.0.1:6379</span>&gt; HEXISTS myhash field2<br><br>(integer) <span class="hljs-number">1</span><br></code></pre></td></tr></table></figure>
<h4 id="5-5、查询所有的key和value">5.5、查询所有的key和value</h4>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">127</span>.<span class="hljs-number">0</span>.<span class="hljs-number">0</span>.<span class="hljs-number">1</span>:<span class="hljs-number">6379</span>&gt; HKEYS myhash                        # 查询所有的key值<br><br><span class="hljs-attribute">1</span>) <span class="hljs-string">&quot;field2&quot;</span><br><br><span class="hljs-attribute">2</span>) <span class="hljs-string">&quot;field1&quot;</span><br><br><span class="hljs-attribute">127</span>.<span class="hljs-number">0</span>.<span class="hljs-number">0</span>.<span class="hljs-number">1</span>:<span class="hljs-number">6379</span>&gt; hvals myhash                        # 查询所有的value值<br><br><span class="hljs-attribute">1</span>) <span class="hljs-string">&quot;world&quot;</span><br><br><span class="hljs-attribute">2</span>) <span class="hljs-string">&quot;chenning&quot;</span><br></code></pre></td></tr></table></figure>
<h4 id="5-6、自增和自减">5.6、自增和自减</h4>
<figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs accesslog"><span class="hljs-number">127.0.0.1:6379</span>&gt; hset myhash field3 <span class="hljs-number">5</span><br><br>(integer) <span class="hljs-number">1</span><br><br><span class="hljs-number">127.0.0.1:6379</span>&gt; HINCRBY myhash field3 <span class="hljs-number">1</span>             #incrby 命令    <br><br>(integer) <span class="hljs-number">6</span><br><br><span class="hljs-number">127.0.0.1:6379</span>&gt; HINCRBY myhash field3 -<span class="hljs-number">1</span>            #增加负值<br><br>(integer) <span class="hljs-number">5</span><br></code></pre></td></tr></table></figure>
<h4 id="5-7、setnx">5.7、setnx</h4>
<figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs accesslog"><br><span class="hljs-number">127.0.0.1:6379</span>&gt; HSETNX myhash field4 hello        #和之前一样，不存在才可以设置，若存在则不可以使用该命令更改<br><br>(integer) <span class="hljs-number">1</span>  <br><br><span class="hljs-number">127.0.0.1:6379</span>&gt; HSETNX myhash field4 world<br><br>(integer) <span class="hljs-number">0</span><br></code></pre></td></tr></table></figure>
<p>hash适合变更的数据user、name、age 尤其是用户信息之类的经常变动的信息，hash更适合对象的存储，String更适合字符串的存储</p>
<h3 id="6、Zset-有序集合">6、Zset  有序集合</h3>
<p>相对于set 就是增加了排序的功能，其他功能set有的，他都有</p>
<h4 id="6-1、增加和查看元素">6.1、增加和查看元素</h4>
<figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs accesslog"><br><span class="hljs-number">127.0.0.1:6379</span>&gt; ZADD myset <span class="hljs-number">1</span> one<br><br>(integer) <span class="hljs-number">1</span><br><br><span class="hljs-number">127.0.0.1:6379</span>&gt; ZADD myset <span class="hljs-number">2</span> two <span class="hljs-number">3</span> three<br><br>(integer) <span class="hljs-number">2</span><br><br><span class="hljs-number">127.0.0.1:6379</span>&gt; ZRANGE myset <span class="hljs-number">0</span> -<span class="hljs-number">1</span><br><br><span class="hljs-number">1</span>) <span class="hljs-string">&quot;one&quot;</span><br><br><span class="hljs-number">2</span>) <span class="hljs-string">&quot;two&quot;</span><br><br><span class="hljs-number">3</span>) <span class="hljs-string">&quot;three&quot;</span><br></code></pre></td></tr></table></figure>
<h4 id="6-2、排序">6.2、排序</h4>
<figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs accesslog"><span class="hljs-number">127.0.0.1:6379</span>&gt; ZADD salary <span class="hljs-number">2500</span> xiaohong <br><br>(integer) <span class="hljs-number">1</span><br><br><span class="hljs-number">127.0.0.1:6379</span>&gt; ZADD salary <span class="hljs-number">5000</span> zhangsan<br><br>(integer) <span class="hljs-number">1</span><br><br><span class="hljs-number">127.0.0.1:6379</span>&gt; ZADD salary <span class="hljs-number">500</span> chenning<br><br>(integer) <span class="hljs-number">1</span><br><br><span class="hljs-number">127.0.0.1:6379</span>&gt; ZRANGEBYSCORE salary -inf +inf                #按照从小到大的顺序排序   -inf 负无穷 +inf 正无穷<br><br><span class="hljs-number">1</span>) <span class="hljs-string">&quot;chenning&quot;</span><br><br><span class="hljs-number">2</span>) <span class="hljs-string">&quot;xiaohong&quot;</span><br><br><span class="hljs-number">3</span>) <span class="hljs-string">&quot;zhangsan&quot;</span><br><br></code></pre></td></tr></table></figure>
<p>排序的其他操作</p>
<figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs accesslog"><br><span class="hljs-number">127.0.0.1:6379</span>&gt; ZADD salary <span class="hljs-number">2500</span> xiaohong <br><br>(integer) <span class="hljs-number">1</span><br><br><span class="hljs-number">127.0.0.1:6379</span>&gt; ZADD salary <span class="hljs-number">5000</span> zhangsan<br><br>(integer) <span class="hljs-number">1</span><br><br><span class="hljs-number">127.0.0.1:6379</span>&gt; ZADD salary <span class="hljs-number">500</span> chenning<br><br>(integer) <span class="hljs-number">1</span><br><br><span class="hljs-number">127.0.0.1:6379</span>&gt; ZRANGEBYSCORE salary -inf +inf<br><br><span class="hljs-number">1</span>) <span class="hljs-string">&quot;chenning&quot;</span><br><br><span class="hljs-number">2</span>) <span class="hljs-string">&quot;xiaohong&quot;</span><br><br><span class="hljs-number">3</span>) <span class="hljs-string">&quot;zhangsan&quot;</span><br><br><span class="hljs-number">127.0.0.1:6379</span>&gt; ZRANGEBYSCORE salary <span class="hljs-number">0</span> -<span class="hljs-number">1</span><br><br>(empty array)<br><br><span class="hljs-number">127.0.0.1:6379</span>&gt; ZRANGEBYSCORE salary -inf <span class="hljs-number">2500</span> withscores     #显示从负无穷到<span class="hljs-number">2500</span>的元素，并把数据显示出来  <br><br><span class="hljs-number">1</span>) <span class="hljs-string">&quot;chenning&quot;</span><br><br><span class="hljs-number">2</span>) <span class="hljs-string">&quot;500&quot;</span><br><br><span class="hljs-number">3</span>) <span class="hljs-string">&quot;xiaohong&quot;</span><br><br><span class="hljs-number">4</span>) <span class="hljs-string">&quot;2500&quot;</span><br><br></code></pre></td></tr></table></figure>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">127</span>.<span class="hljs-number">0</span>.<span class="hljs-number">0</span>.<span class="hljs-number">1</span>:<span class="hljs-number">6379</span>&gt; ZREVRANGE salary <span class="hljs-number">0</span> -<span class="hljs-number">1</span><br><br><span class="hljs-attribute">1</span>) <span class="hljs-string">&quot;zhangsan&quot;</span><br><br><span class="hljs-attribute">2</span>) <span class="hljs-string">&quot;chenning&quot;</span><br><br><span class="hljs-attribute">127</span>.<span class="hljs-number">0</span>.<span class="hljs-number">0</span>.<span class="hljs-number">1</span>:<span class="hljs-number">6379</span>&gt; ZREVRANGE salary <span class="hljs-number">0</span> -<span class="hljs-number">1</span> withscores       #使用 revrange 进行倒序排序<br><br><span class="hljs-attribute">1</span>) <span class="hljs-string">&quot;zhangsan&quot;</span><br><br><span class="hljs-attribute">2</span>) <span class="hljs-string">&quot;5000&quot;</span><br><br><span class="hljs-attribute">3</span>) <span class="hljs-string">&quot;chenning&quot;</span><br><br><span class="hljs-attribute">4</span>) <span class="hljs-string">&quot;500&quot;</span><br></code></pre></td></tr></table></figure>
<h4 id="6-3、移除元素">6.3、移除元素</h4>
<figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs accesslog"><br><span class="hljs-number">127.0.0.1:6379</span>&gt; ZRANGE salary <span class="hljs-number">0</span> -<span class="hljs-number">1</span><br><br><span class="hljs-number">1</span>) <span class="hljs-string">&quot;chenning&quot;</span><br><br><span class="hljs-number">2</span>) <span class="hljs-string">&quot;xiaohong&quot;</span><br><br><span class="hljs-number">3</span>) <span class="hljs-string">&quot;zhangsan&quot;</span><br><br><span class="hljs-number">127.0.0.1:6379</span>&gt; zrem salary xiaohong          # remove 这个元素<br><br>(integer) <span class="hljs-number">1</span><br><br><span class="hljs-number">127.0.0.1:6379</span>&gt; ZRANGE salary <span class="hljs-number">0</span> -<span class="hljs-number">1</span><br><br><span class="hljs-number">1</span>) <span class="hljs-string">&quot;chenning&quot;</span><br><br><span class="hljs-number">2</span>) <span class="hljs-string">&quot;zhangsan&quot;</span><br></code></pre></td></tr></table></figure>
<h4 id="6-4、获取元素个数">6.4、获取元素个数</h4>
<figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs accesslog"><span class="hljs-number">127.0.0.1:6379</span>&gt; zcard salary<br><br>(integer) <span class="hljs-number">2</span>  获取个数<br></code></pre></td></tr></table></figure>
<h2 id="五、三大特殊数据类型">五、三大特殊数据类型</h2>
<h3 id="1、geospatial">1、geospatial</h3>
<h4 id="1-1、-getadd">1.1、 getadd</h4>
<p>添加国家城市的经纬度信息</p>
<figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs accesslog"><span class="hljs-number">127.0.0.1:6379</span>&gt; GEOADD china:city <span class="hljs-number">116</span>.<span class="hljs-number">40</span> <span class="hljs-number">39</span>.<span class="hljs-number">90</span> beijing<br><br>(integer) <span class="hljs-number">1</span><br><br><span class="hljs-number">127.0.0.1:6379</span>&gt; GEOADD china:city <span class="hljs-number">121</span>.<span class="hljs-number">47</span> <span class="hljs-number">31</span>.<span class="hljs-number">23</span> shanghai<br><br>(integer) <span class="hljs-number">1</span><br><br><span class="hljs-number">127.0.0.1:6379</span>&gt; GEOADD china:city <span class="hljs-number">106</span>.<span class="hljs-number">50</span> <span class="hljs-number">29</span>.<span class="hljs-number">53</span> chongqing<br><br>(integer) <span class="hljs-number">1</span><br><br><span class="hljs-number">127.0.0.1:6379</span>&gt; GEOADD china:city <span class="hljs-number">114</span>.<span class="hljs-number">05</span> <span class="hljs-number">22</span>.<span class="hljs-number">52</span> shenzheng<br><br>(integer) <span class="hljs-number">1</span><br><br><span class="hljs-number">127.0.0.1:6379</span>&gt; GEOADD china:city <span class="hljs-number">120</span>.<span class="hljs-number">16</span> <span class="hljs-number">30</span>.<span class="hljs-number">24</span> hangzhou<br><br>(integer) <span class="hljs-number">1</span><br><br><span class="hljs-number">127.0.0.1:6379</span>&gt; GEOADD china:city <span class="hljs-number">108</span>.<span class="hljs-number">96</span> <span class="hljs-number">34</span>.<span class="hljs-number">26</span> xian<br><br>(integer) <span class="hljs-number">1</span><br></code></pre></td></tr></table></figure>
<blockquote>
<p>注意事项</p>
</blockquote>
<ul>
<li>两级无法直接添加，一般可以可以通过Java一键导入所有城市的信息</li>
<li>有效的经度从-180度到180度</li>
<li>有效的维度信息从-85.05112878到85.05112878度</li>
<li>当坐标位置超出上述的指定的范围的时候，该命令回返回一个错误</li>
</ul>
<h4 id="1-2、getpos">1.2、getpos</h4>
<p>获取城市的位置信息</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs apache"><br><span class="hljs-attribute">127</span>.<span class="hljs-number">0</span>.<span class="hljs-number">0</span>.<span class="hljs-number">1</span>:<span class="hljs-number">6379</span>&gt; GEOPOS china:city beijing chongqing<br><br><span class="hljs-attribute">1</span>) <span class="hljs-number">1</span>) <span class="hljs-string">&quot;116.39999896287918091&quot;</span><br><br>  <span class="hljs-attribute">2</span>) <span class="hljs-string">&quot;39.90000009167092543&quot;</span><br><br><span class="hljs-attribute">2</span>) <span class="hljs-number">1</span>) <span class="hljs-string">&quot;106.49999767541885376&quot;</span><br><br>  <span class="hljs-attribute">2</span>) <span class="hljs-string">&quot;29.52999957900659211&quot;</span><br></code></pre></td></tr></table></figure>
<h4 id="1-3、geodist">1.3、geodist</h4>
<p>获取两点之间的距离信息</p>
<figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs accesslog"><span class="hljs-number">127.0.0.1:6379</span>&gt; GEODIST china:city beijing shanghai km       # 这后面的km是可以换的， 比如 m 等都可以<br><br><span class="hljs-string">&quot;1067.3788&quot;</span><br><br><span class="hljs-number">127.0.0.1:6379</span>&gt; GEODIST china:city beijing chongqing km<br><br><span class="hljs-string">&quot;1464.0708&quot;</span><br></code></pre></td></tr></table></figure>
<h4 id="1-4、georadius">1.4、georadius</h4>
<p>查询指定范围内的城市信息</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">127</span>.<span class="hljs-number">0</span>.<span class="hljs-number">0</span>.<span class="hljs-number">1</span>:<span class="hljs-number">6379</span>&gt; GEORADIUS china:city <span class="hljs-number">110</span> <span class="hljs-number">30</span> <span class="hljs-number">1000</span> km          #查询以经纬度<span class="hljs-number">110</span> <span class="hljs-number">30</span>为圆心周围<span class="hljs-number">1000</span>km的城市位置信息 <br><br><span class="hljs-attribute">1</span>) <span class="hljs-string">&quot;chongqing&quot;</span><br><br><span class="hljs-attribute">2</span>) <span class="hljs-string">&quot;xian&quot;</span><br><br><span class="hljs-attribute">3</span>) <span class="hljs-string">&quot;shenzheng&quot;</span><br><br><span class="hljs-attribute">4</span>) <span class="hljs-string">&quot;hangzhou&quot;</span><br><br></code></pre></td></tr></table></figure>
<p>其他的附带参数</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">127</span>.<span class="hljs-number">0</span>.<span class="hljs-number">0</span>.<span class="hljs-number">1</span>:<span class="hljs-number">6379</span>&gt; GEORADIUS china:city <span class="hljs-number">110</span> <span class="hljs-number">30</span> <span class="hljs-number">500</span> km withcoord     #跟上面的一样，但是带经纬度的参数<br><br><span class="hljs-attribute">1</span>) <span class="hljs-number">1</span>) <span class="hljs-string">&quot;chongqing&quot;</span><br><br>  <span class="hljs-attribute">2</span>) <span class="hljs-number">1</span>) <span class="hljs-string">&quot;106.49999767541885376&quot;</span><br><br>   <span class="hljs-attribute">2</span>) <span class="hljs-string">&quot;29.52999957900659211&quot;</span><br><br><span class="hljs-attribute">2</span>) <span class="hljs-number">1</span>) <span class="hljs-string">&quot;xian&quot;</span><br><br>  <span class="hljs-attribute">2</span>) <span class="hljs-number">1</span>) <span class="hljs-string">&quot;108.96000176668167114&quot;</span><br><br>   <span class="hljs-attribute">2</span>) <span class="hljs-string">&quot;34.25999964418929977&quot;</span><br></code></pre></td></tr></table></figure>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">127</span>.<span class="hljs-number">0</span>.<span class="hljs-number">0</span>.<span class="hljs-number">1</span>:<span class="hljs-number">6379</span>&gt; GEORADIUS china:city <span class="hljs-number">110</span> <span class="hljs-number">30</span> <span class="hljs-number">500</span> km withdist    #带距离指定位置的距离参数<br><br><span class="hljs-attribute">1</span>) <span class="hljs-number">1</span>) <span class="hljs-string">&quot;chongqing&quot;</span><br><br>  <span class="hljs-attribute">2</span>) <span class="hljs-string">&quot;341.9374&quot;</span><br><br><span class="hljs-attribute">2</span>) <span class="hljs-number">1</span>) <span class="hljs-string">&quot;xian&quot;</span><br><br>  <span class="hljs-attribute">2</span>) <span class="hljs-string">&quot;483.8340&quot;</span><br></code></pre></td></tr></table></figure>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">127</span>.<span class="hljs-number">0</span>.<span class="hljs-number">0</span>.<span class="hljs-number">1</span>:<span class="hljs-number">6379</span>&gt; GEORADIUS china:city <span class="hljs-number">110</span> <span class="hljs-number">30</span> <span class="hljs-number">500</span> km withdist withcoord count <span class="hljs-number">1</span>   #带只查询一个的指令参数<br><br><span class="hljs-attribute">1</span>) <span class="hljs-number">1</span>) <span class="hljs-string">&quot;chongqing&quot;</span><br><br>  <span class="hljs-attribute">2</span>) <span class="hljs-string">&quot;341.9374&quot;</span><br><br>  <span class="hljs-attribute">3</span>) <span class="hljs-number">1</span>) <span class="hljs-string">&quot;106.49999767541885376&quot;</span><br><br>   <span class="hljs-attribute">2</span>) <span class="hljs-string">&quot;29.52999957900659211&quot;</span><br></code></pre></td></tr></table></figure>
<p>通过指定元素来查找元素</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">127</span>.<span class="hljs-number">0</span>.<span class="hljs-number">0</span>.<span class="hljs-number">1</span>:<span class="hljs-number">6379</span>&gt; GEORADIUSBYMEMBER china:city beijing <span class="hljs-number">1000</span> km      #距离北京<span class="hljs-number">1000</span>km的所有元素<br><br><span class="hljs-attribute">1</span>) <span class="hljs-string">&quot;beijing&quot;</span><br><br><span class="hljs-attribute">2</span>) <span class="hljs-string">&quot;xian&quot;</span><br></code></pre></td></tr></table></figure>
<h4 id="1-5、将经纬度转化">1.5、将经纬度转化</h4>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">127</span>.<span class="hljs-number">0</span>.<span class="hljs-number">0</span>.<span class="hljs-number">1</span>:<span class="hljs-number">6379</span>&gt; GEOHASH china:city beijing chongqing       #二维的经纬度转换为一位的字符串 字符串长得越想就越接近<br><br><span class="hljs-attribute">1</span>) <span class="hljs-string">&quot;wx4fbxxfke0&quot;</span><br><br><span class="hljs-attribute">2</span>) <span class="hljs-string">&quot;wm5xzrybty0&quot;</span><br></code></pre></td></tr></table></figure>
<h4 id="1-6、像set一样操作">1.6、像set一样操作</h4>
<p>因为其实本质上就是zset所有下面这些操作是都可以进行的</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs ruby"><span class="hljs-meta">127.0.0.1:6379&gt;</span> ZRANGE <span class="hljs-symbol">china:</span>city <span class="hljs-number">0</span> -<span class="hljs-number">1</span><br><br><span class="hljs-number">1</span>) <span class="hljs-string">&quot;chongqing&quot;</span><br><br><span class="hljs-number">2</span>) <span class="hljs-string">&quot;xian&quot;</span><br><br><span class="hljs-number">3</span>) <span class="hljs-string">&quot;shenzheng&quot;</span><br><br><span class="hljs-number">4</span>) <span class="hljs-string">&quot;hangzhou&quot;</span><br><br><span class="hljs-number">5</span>) <span class="hljs-string">&quot;shanghai&quot;</span><br><br><span class="hljs-number">6</span>) <span class="hljs-string">&quot;beijing&quot;</span><br><br><span class="hljs-meta">127.0.0.1:6379&gt;</span> ZREM <span class="hljs-symbol">china:</span>city beijing<br><br>(integer) <span class="hljs-number">1</span><br><br><span class="hljs-meta">127.0.0.1:6379&gt;</span> ZRANGE <span class="hljs-symbol">china:</span>city <span class="hljs-number">0</span> -<span class="hljs-number">1</span><br><br><span class="hljs-number">1</span>) <span class="hljs-string">&quot;chongqing&quot;</span><br><br><span class="hljs-number">2</span>) <span class="hljs-string">&quot;xian&quot;</span><br><br><span class="hljs-number">3</span>) <span class="hljs-string">&quot;shenzheng&quot;</span><br><br><span class="hljs-number">4</span>) <span class="hljs-string">&quot;hangzhou&quot;</span><br><br><span class="hljs-number">5</span>) <span class="hljs-string">&quot;shanghai&quot;</span><br></code></pre></td></tr></table></figure>
<h3 id="2、hyperloglog">2、hyperloglog</h3>
<p>hyperloglog主要就是关于基数的操作，而基数就是不重复的元素</p>
<p>优点就是占用的内存固定，2^64不同的元素的技术，只需要12kb的内存，例如在统计网站的访问的次数的时候，一个人访问多次，就可以记为一次。虽然有0.81%的错误率，但是可以忽略</p>
<figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs accesslog"><span class="hljs-number">127.0.0.1:6379</span>&gt; PFADD mykey a b c d e f g h i j     # 添加元素<br><br>(integer) <span class="hljs-number">1</span><br><br><span class="hljs-number">127.0.0.1:6379</span>&gt; PFCOUNT mykey                       # 计数元素的个数<br><br>(integer) <span class="hljs-number">10</span><br><br><span class="hljs-number">127.0.0.1:6379</span>&gt; PFADD mykey2 i j z x c v b n m<br><br>(integer) <span class="hljs-number">1</span><br><br><span class="hljs-number">127.0.0.1:6379</span>&gt; PFMERGE mykey3 mykey mykey2         #将mykey mykey2中的元素合并到mykey3中<br><br>OK<br><br><span class="hljs-number">127.0.0.1:6379</span>&gt; PFCOUNT mykey3                      #合并后只有不重复的元素，所有这里只有<span class="hljs-number">15</span>个元素<br><br>(integer) <span class="hljs-number">15</span><br></code></pre></td></tr></table></figure>
<h3 id="3、bitmaps">3、bitmaps</h3>
<blockquote>
<p>位存储<br>
统计用户信息，是否活跃，是否登录，两个状态的，都可以使用Bitmaps，Bitmap 位图是数据结构，都是操作二进制来进行记录，只有0和1两个状态，</p>
</blockquote>
<figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs accesslog"><span class="hljs-number">127.0.0.1:6379</span>&gt; setbit sign <span class="hljs-number">0</span> <span class="hljs-number">1</span>                   #为每一位设置状态<br><br>(integer) <span class="hljs-number">0</span><br><br><span class="hljs-number">127.0.0.1:6379</span>&gt; setbit sign <span class="hljs-number">1</span> <span class="hljs-number">0</span><br><br>(integer) <span class="hljs-number">0</span><br><br><span class="hljs-number">127.0.0.1:6379</span>&gt; setbit sign <span class="hljs-number">2</span> <span class="hljs-number">0</span><br><br>(integer) <span class="hljs-number">0</span><br><br><span class="hljs-number">127.0.0.1:6379</span>&gt; setbit sign <span class="hljs-number">3</span> <span class="hljs-number">1</span> <br><br>(integer) <span class="hljs-number">0</span><br><br><span class="hljs-number">127.0.0.1:6379</span>&gt; setbit sign <span class="hljs-number">4</span> <span class="hljs-number">1</span><br><br>(integer) <span class="hljs-number">0</span><br><br><span class="hljs-number">127.0.0.1:6379</span>&gt; setbit sign <span class="hljs-number">5</span> <span class="hljs-number">0</span><br><br>(integer) <span class="hljs-number">0</span><br><br><span class="hljs-number">127.0.0.1:6379</span>&gt; setbit sign <span class="hljs-number">6</span> <span class="hljs-number">0</span><br><br>(integer) <span class="hljs-number">0</span><br><br><span class="hljs-number">127.0.0.1:6379</span>&gt; getbit sign <span class="hljs-number">3</span>                     #获取状态<br><br>(integer) <span class="hljs-number">1</span><br><br><span class="hljs-number">127.0.0.1:6379</span>&gt; getbit sign <span class="hljs-number">5</span><br><br>(integer) <span class="hljs-number">0</span><br></code></pre></td></tr></table></figure>
<p>获取sign为1的数量</p>
<figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs accesslog"><span class="hljs-number">127.0.0.1:6379</span>&gt; BITCOUNT sign<br><br>(integer) <span class="hljs-number">3</span><br><br></code></pre></td></tr></table></figure>
<h2 id="六、事务">六、事务</h2>
<ul>
<li>Redis事务的本质就是一组命令的组合，一个事务中所有的命令都会被序列化，在事务执行的过程中，会按照顺序执行，一次性，顺序性，排他性的执行一些列的命令</li>
<li>Redis的事务没有隔离级别的概念，所有的命令在事务中，只有发起执行命令<strong>exec</strong> 才会执行</li>
<li>Redis单条命令式保留原子性，但是事务并不保留原子性，</li>
</ul>
<blockquote>
<p>redis的事务</p>
</blockquote>
<ul>
<li>开启事务(multi)</li>
<li>命令入队</li>
<li>执行事务(exec)</li>
</ul>
<h3 id="1、正常的执行事务">1、正常的执行事务</h3>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">127</span>.<span class="hljs-number">0</span>.<span class="hljs-number">0</span>.<span class="hljs-number">1</span>:<span class="hljs-number">6379</span>&gt; multi               #开启事务命令<br><br><span class="hljs-attribute">OK</span><br><br><span class="hljs-attribute">127</span>.<span class="hljs-number">0</span>.<span class="hljs-number">0</span>.<span class="hljs-number">1</span>:<span class="hljs-number">6379</span>(TX)&gt; set k<span class="hljs-number">1</span> v<span class="hljs-number">1</span><br><br><span class="hljs-attribute">QUEUED</span><br><br><span class="hljs-attribute">127</span>.<span class="hljs-number">0</span>.<span class="hljs-number">0</span>.<span class="hljs-number">1</span>:<span class="hljs-number">6379</span>(TX)&gt; set k<span class="hljs-number">2</span> v<span class="hljs-number">2</span><br><br><span class="hljs-attribute">QUEUED</span><br><br><span class="hljs-attribute">127</span>.<span class="hljs-number">0</span>.<span class="hljs-number">0</span>.<span class="hljs-number">1</span>:<span class="hljs-number">6379</span>(TX)&gt; get k<span class="hljs-number">2</span><br><br><span class="hljs-attribute">QUEUED</span><br><br><span class="hljs-attribute">127</span>.<span class="hljs-number">0</span>.<span class="hljs-number">0</span>.<span class="hljs-number">1</span>:<span class="hljs-number">6379</span>(TX)&gt; set k<span class="hljs-number">3</span> v<span class="hljs-number">3</span><br><br><span class="hljs-attribute">QUEUED</span><br> <br><span class="hljs-attribute">127</span>.<span class="hljs-number">0</span>.<span class="hljs-number">0</span>.<span class="hljs-number">1</span>:<span class="hljs-number">6379</span>(TX)&gt; exec            #执行事务命令<br><br><span class="hljs-attribute">1</span>) OK<br><br><span class="hljs-attribute">2</span>) OK<br><br><span class="hljs-attribute">3</span>) <span class="hljs-string">&quot;v2&quot;</span><br><br><span class="hljs-attribute">4</span>) OK<br></code></pre></td></tr></table></figure>
<h3 id="2、放弃事务">2、放弃事务</h3>
<figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs accesslog"><br><span class="hljs-number">127.0.0.1:6379</span>&gt; MULTI<br><br>OK<br><br><span class="hljs-number">127.0.0.1:6379</span>(TX)&gt; set k1 v1 <br><br>QUEUED<br><br><span class="hljs-number">127.0.0.1:6379</span>(TX)&gt; set k4 v4<br><br>QUEUED<br><br><span class="hljs-number">127.0.0.1:6379</span>(TX)&gt; DISCARD           #放弃事务命令<br><br>OK<br><br><span class="hljs-number">127.0.0.1:6379</span>&gt; get k4<br><br>(nil)<br></code></pre></td></tr></table></figure>
<h3 id="3、执行事务时的异常">3、执行事务时的异常</h3>
<p>事务的异常分为两种，编译时的异常和执行时的异常，下面主要写一下两种异常的不同点</p>
<h4 id="3-1、编译时异常">3.1、编译时异常</h4>
<p>编译时的异常即代表你的语法可能就有问题，一旦一句有问题，整个事务都不能正常运行</p>
<figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs accesslog"><span class="hljs-number">127.0.0.1:6379</span>&gt; multi<br><br>OK<br><br><span class="hljs-number">127.0.0.1:6379</span>(TX)&gt; set k1 v1<br><br>QUEUED<br><br><span class="hljs-number">127.0.0.1:6379</span>(TX)&gt; set k2 v2<br><br>QUEUED<br><br><span class="hljs-number">127.0.0.1:6379</span>(TX)&gt; getset k3<br><br>(error) ERR wrong number of arguments for &#x27;getset&#x27; command         #这里就开始提示有err<br><br><span class="hljs-number">127.0.0.1:6379</span>(TX)&gt; set k4 v4<br><br>QUEUED<br><br><span class="hljs-number">127.0.0.1:6379</span>(TX)&gt; exec<br><br>(error) EXECABORT Transaction discarded because of previous errors.         # 导致整个事务都不能正常运行<br><br><span class="hljs-number">127.0.0.1:6379</span>&gt; get k5<br><br>(nil)<br></code></pre></td></tr></table></figure>
<h4 id="3-2、运行时错误">3.2、运行时错误</h4>
<p>运行时错误表示语法没有啥问题，是其他地方除了问题，仅仅只影响那一句话，其他的依旧可以正常的执行</p>
<figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs accesslog"><span class="hljs-number">127.0.0.1:6379</span>&gt; MULTI<br><br>OK<br><br><span class="hljs-number">127.0.0.1:6379</span>(TX)&gt; incr k1           #这里的k1对应的value是一个字符串，是不能增加 <span class="hljs-number">1</span> 的<br><br>QUEUED<br><br><span class="hljs-number">127.0.0.1:6379</span>(TX)&gt; set k2 v2<br><br>QUEUED<br><br><span class="hljs-number">127.0.0.1:6379</span>(TX)&gt; set k3 v3<br><br>QUEUED<br><br><span class="hljs-number">127.0.0.1:6379</span>(TX)&gt; get k3<br><br>QUEUED                                  #前面的语句语法都没有任何的问题 <br><br><span class="hljs-number">127.0.0.1:6379</span>(TX)&gt; exec<br><br><span class="hljs-number">1</span>) (error) ERR value is not an integer or out of range       #事务的第一句不能正常执行<br><br><span class="hljs-number">2</span>) OK<br><br><span class="hljs-number">3</span>) OK<br><br><span class="hljs-number">4</span>) <span class="hljs-string">&quot;v3&quot;</span><br><br><span class="hljs-number">127.0.0.1:6379</span>&gt; get k2<br><br><span class="hljs-string">&quot;v2&quot;</span><br><br><span class="hljs-number">127.0.0.1:6379</span>&gt; get k3<br><br><span class="hljs-string">&quot;v3&quot;</span>                                     #事务的其他语句是可以正常运行的<br></code></pre></td></tr></table></figure>
<h2 id="七、Redis实现乐观锁">七、Redis实现乐观锁</h2>
<blockquote>
<p>悲观锁</p>
</blockquote>
<p>认为什么时候都会出错，无论做什么都会枷锁，效率低下</p>
<blockquote>
<p>乐观锁</p>
</blockquote>
<p>-认为什么时候都不会出问题，所以不会上锁，更新数据的时候去判断一下，在此期间是否有人去修改过这个数据</p>
<ul>
<li>获取version</li>
<li>更新的时候比较version</li>
</ul>
<p><strong>单线程的时候</strong></p>
<figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs accesslog"><span class="hljs-number">127.0.0.1:6379</span>&gt; set money <span class="hljs-number">100</span><br><br>OK<br><br><span class="hljs-number">127.0.0.1:6379</span>&gt; set out <span class="hljs-number">0</span><br><br>OK<br><br><span class="hljs-number">127.0.0.1:6379</span>&gt; watch money    # 加锁<br><br>OK<br><br><span class="hljs-number">127.0.0.1:6379</span>&gt; multi<br><br>OK<br><br><span class="hljs-number">127.0.0.1:6379</span>(TX)&gt; DECRBY money <span class="hljs-number">20</span><br><br>QUEUED<br><br><span class="hljs-number">127.0.0.1:6379</span>(TX)&gt; INCRBY out <span class="hljs-number">20</span><br><br>QUEUED<br><br><span class="hljs-number">127.0.0.1:6379</span>(TX)&gt; exec<br><br><span class="hljs-number">1</span>) (integer) <span class="hljs-number">80</span><br><br><span class="hljs-number">2</span>) (integer) <span class="hljs-number">20</span><br></code></pre></td></tr></table></figure>
<figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs accesslog"><span class="hljs-number">127.0.0.1:6379</span>&gt; watch money<br><br>OK<br><br><span class="hljs-number">127.0.0.1:6379</span>&gt; multi<br><br>OK<br><br><span class="hljs-number">127.0.0.1:6379</span>(TX)&gt; DECRBY money <span class="hljs-number">10</span><br><br>QUEUED<br><br><span class="hljs-number">127.0.0.1:6379</span>(TX)&gt; INCRBY out <span class="hljs-number">10</span><br><br>QUEUED<br><br><span class="hljs-number">127.0.0.1:6379</span>(TX)&gt; exec      # 在执行这个事务前，有其他的线程改变了这个值，则会导致执行失败<br><br>(nil)<br></code></pre></td></tr></table></figure>
<p>若执行失败，则正确操作为:<br>
<img src="https://img-blog.csdnimg.cn/ccf1491997604555802786a4838fb3e6.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBATWVyY3VyeTIuIDA=,size_20,color_FFFFFF,t_70,g_se,x_16" srcset="/img/newloading.gif" lazyload alt="解锁"></p>
<h2 id="八、Jedis">八、Jedis</h2>
<p>就是使用Java操作redis</p>
<h3 id="1、简单的使用一下Jedis">1、简单的使用一下Jedis</h3>
<p>首先导入包</p>
<p><img src="https://s2.loli.net/2022/04/14/V9qPSWK72ebiouh.png" srcset="/img/newloading.gif" lazyload alt="image-20220414100910101"></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- https://mvnrepository.com/artifact/redis.clients/jedis --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>redis.clients<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>jedis<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>4.2.2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure>
<p><img src="https://s2.loli.net/2022/04/14/bC7i5e9qy3Y6AoT.png" srcset="/img/newloading.gif" lazyload alt="image-20220414100943921"></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- https://mvnrepository.com/artifact/com.alibaba/fastjson --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.alibaba<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>fastjson<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.2.80<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure>
<p>简单的使用</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-keyword">static</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span></span>&#123;&#125;<br>     jedis jedis = <span class="hljs-keyword">new</span> Jedis(<span class="hljs-string">&quot;127.0.0.1&quot;</span>);<span class="hljs-comment">//使用对象来操作</span><br>     Sysrtem.out.printn(jedis.ping);<span class="hljs-comment">//测试链接</span><br>&#125;<br></code></pre></td></tr></table></figure>
<h3 id="2、常用的api">2、常用的api</h3>
<h4 id="String">String</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> redis.clients.jedis.Jedis;<br><br><span class="hljs-keyword">import</span> java.util.concurrent.TimeUnit;<br><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TestString</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>        Jedis jedis = <span class="hljs-keyword">new</span> Jedis(<span class="hljs-string">&quot;127.0.0.1&quot;</span>, <span class="hljs-number">6379</span>);<br><br>        jedis.flushDB();<br>        System.out.println(<span class="hljs-string">&quot;===========增加数据===========&quot;</span>);<br>        System.out.println(jedis.set(<span class="hljs-string">&quot;key1&quot;</span>,<span class="hljs-string">&quot;value1&quot;</span>));<br>        System.out.println(jedis.set(<span class="hljs-string">&quot;key2&quot;</span>,<span class="hljs-string">&quot;value2&quot;</span>));<br>        System.out.println(jedis.set(<span class="hljs-string">&quot;key3&quot;</span>, <span class="hljs-string">&quot;value3&quot;</span>));<br>        System.out.println(<span class="hljs-string">&quot;删除键key2:&quot;</span>+jedis.del(<span class="hljs-string">&quot;key2&quot;</span>));<br>        System.out.println(<span class="hljs-string">&quot;获取键key2:&quot;</span>+jedis.get(<span class="hljs-string">&quot;key2&quot;</span>));<br>        System.out.println(<span class="hljs-string">&quot;修改key1:&quot;</span>+jedis.set(<span class="hljs-string">&quot;key1&quot;</span>, <span class="hljs-string">&quot;value1Changed&quot;</span>));<br>        System.out.println(<span class="hljs-string">&quot;获取key1的值：&quot;</span>+jedis.get(<span class="hljs-string">&quot;key1&quot;</span>));<br>        System.out.println(<span class="hljs-string">&quot;在key3后面加入值：&quot;</span>+jedis.append(<span class="hljs-string">&quot;key3&quot;</span>, <span class="hljs-string">&quot;End&quot;</span>));<br>        System.out.println(<span class="hljs-string">&quot;key3的值：&quot;</span>+jedis.get(<span class="hljs-string">&quot;key3&quot;</span>));<br>        System.out.println(<span class="hljs-string">&quot;增加多个键值对：&quot;</span>+jedis.mset(<span class="hljs-string">&quot;key01&quot;</span>,<span class="hljs-string">&quot;value01&quot;</span>,<span class="hljs-string">&quot;key02&quot;</span>,<span class="hljs-string">&quot;value02&quot;</span>,<span class="hljs-string">&quot;key03&quot;</span>,<span class="hljs-string">&quot;value03&quot;</span>));<br>        System.out.println(<span class="hljs-string">&quot;获取多个键值对：&quot;</span>+jedis.mget(<span class="hljs-string">&quot;key01&quot;</span>,<span class="hljs-string">&quot;key02&quot;</span>,<span class="hljs-string">&quot;key03&quot;</span>));<br>        System.out.println(<span class="hljs-string">&quot;获取多个键值对：&quot;</span>+jedis.mget(<span class="hljs-string">&quot;key01&quot;</span>,<span class="hljs-string">&quot;key02&quot;</span>,<span class="hljs-string">&quot;key03&quot;</span>,<span class="hljs-string">&quot;key04&quot;</span>));<br>        System.out.println(<span class="hljs-string">&quot;删除多个键值对：&quot;</span>+jedis.del(<span class="hljs-string">&quot;key01&quot;</span>,<span class="hljs-string">&quot;key02&quot;</span>));<br>        System.out.println(<span class="hljs-string">&quot;获取多个键值对：&quot;</span>+jedis.mget(<span class="hljs-string">&quot;key01&quot;</span>,<span class="hljs-string">&quot;key02&quot;</span>,<span class="hljs-string">&quot;key03&quot;</span>));<br><br>        jedis.flushDB();<br>        System.out.println(<span class="hljs-string">&quot;===========新增键值对防止覆盖原先值==============&quot;</span>);<br>        System.out.println(jedis.setnx(<span class="hljs-string">&quot;key1&quot;</span>, <span class="hljs-string">&quot;value1&quot;</span>));<br>        System.out.println(jedis.setnx(<span class="hljs-string">&quot;key2&quot;</span>, <span class="hljs-string">&quot;value2&quot;</span>));<br>        System.out.println(jedis.setnx(<span class="hljs-string">&quot;key2&quot;</span>, <span class="hljs-string">&quot;value2-new&quot;</span>));<br>        System.out.println(jedis.get(<span class="hljs-string">&quot;key1&quot;</span>));<br>        System.out.println(jedis.get(<span class="hljs-string">&quot;key2&quot;</span>));<br><br>        System.out.println(<span class="hljs-string">&quot;===========新增键值对并设置有效时间=============&quot;</span>);<br>        System.out.println(jedis.setex(<span class="hljs-string">&quot;key3&quot;</span>, <span class="hljs-number">2</span>, <span class="hljs-string">&quot;value3&quot;</span>));<br>        System.out.println(jedis.get(<span class="hljs-string">&quot;key3&quot;</span>));<br>        <span class="hljs-keyword">try</span> &#123;<br>            TimeUnit.SECONDS.sleep(<span class="hljs-number">3</span>);<br>        &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>            e.printStackTrace();<br>        &#125;<br>        System.out.println(jedis.get(<span class="hljs-string">&quot;key3&quot;</span>));<br><br>        System.out.println(<span class="hljs-string">&quot;===========获取原值，更新为新值==========&quot;</span>);<br>        System.out.println(jedis.getSet(<span class="hljs-string">&quot;key2&quot;</span>, <span class="hljs-string">&quot;key2GetSet&quot;</span>));<br>        System.out.println(jedis.get(<span class="hljs-string">&quot;key2&quot;</span>));<br><br>        System.out.println(<span class="hljs-string">&quot;获得key2的值的字串：&quot;</span>+jedis.getrange(<span class="hljs-string">&quot;key2&quot;</span>, <span class="hljs-number">2</span>, <span class="hljs-number">4</span>));<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure>
<h4 id="List">List</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> redis.clients.jedis.Jedis;<br><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TestList</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>        Jedis jedis = <span class="hljs-keyword">new</span> Jedis(<span class="hljs-string">&quot;127.0.0.1&quot;</span>, <span class="hljs-number">6379</span>);<br>        jedis.flushDB();<br>        System.out.println(<span class="hljs-string">&quot;===========添加一个list===========&quot;</span>);<br>        jedis.lpush(<span class="hljs-string">&quot;collections&quot;</span>, <span class="hljs-string">&quot;ArrayList&quot;</span>, <span class="hljs-string">&quot;Vector&quot;</span>, <span class="hljs-string">&quot;Stack&quot;</span>, <span class="hljs-string">&quot;HashMap&quot;</span>, <span class="hljs-string">&quot;WeakHashMap&quot;</span>, <span class="hljs-string">&quot;LinkedHashMap&quot;</span>);<br>        jedis.lpush(<span class="hljs-string">&quot;collections&quot;</span>, <span class="hljs-string">&quot;HashSet&quot;</span>);<br>        jedis.lpush(<span class="hljs-string">&quot;collections&quot;</span>, <span class="hljs-string">&quot;TreeSet&quot;</span>);<br>        jedis.lpush(<span class="hljs-string">&quot;collections&quot;</span>, <span class="hljs-string">&quot;TreeMap&quot;</span>);<br>        System.out.println(<span class="hljs-string">&quot;collections的内容：&quot;</span>+jedis.lrange(<span class="hljs-string">&quot;collections&quot;</span>, <span class="hljs-number">0</span>, -<span class="hljs-number">1</span>));<span class="hljs-comment">//-1代表倒数第一个元素，-2代表倒数第二个元素,end为-1表示查询全部</span><br>        System.out.println(<span class="hljs-string">&quot;collections区间0-3的元素：&quot;</span>+jedis.lrange(<span class="hljs-string">&quot;collections&quot;</span>,<span class="hljs-number">0</span>,<span class="hljs-number">3</span>));<br>        System.out.println(<span class="hljs-string">&quot;===============================&quot;</span>);<br>        <span class="hljs-comment">// 删除列表指定的值 ，第二个参数为删除的个数（有重复时），后add进去的值先被删，类似于出栈</span><br>        System.out.println(<span class="hljs-string">&quot;删除指定元素个数：&quot;</span>+jedis.lrem(<span class="hljs-string">&quot;collections&quot;</span>, <span class="hljs-number">2</span>, <span class="hljs-string">&quot;HashMap&quot;</span>));<br>        System.out.println(<span class="hljs-string">&quot;collections的内容：&quot;</span>+jedis.lrange(<span class="hljs-string">&quot;collections&quot;</span>, <span class="hljs-number">0</span>, -<span class="hljs-number">1</span>));<br>        System.out.println(<span class="hljs-string">&quot;删除下表0-3区间之外的元素：&quot;</span>+jedis.ltrim(<span class="hljs-string">&quot;collections&quot;</span>, <span class="hljs-number">0</span>, <span class="hljs-number">3</span>));<br>        System.out.println(<span class="hljs-string">&quot;collections的内容：&quot;</span>+jedis.lrange(<span class="hljs-string">&quot;collections&quot;</span>, <span class="hljs-number">0</span>, -<span class="hljs-number">1</span>));<br>        System.out.println(<span class="hljs-string">&quot;collections列表出栈（左端）：&quot;</span>+jedis.lpop(<span class="hljs-string">&quot;collections&quot;</span>));<br>        System.out.println(<span class="hljs-string">&quot;collections的内容：&quot;</span>+jedis.lrange(<span class="hljs-string">&quot;collections&quot;</span>, <span class="hljs-number">0</span>, -<span class="hljs-number">1</span>));<br>        System.out.println(<span class="hljs-string">&quot;collections添加元素，从列表右端，与lpush相对应：&quot;</span>+jedis.rpush(<span class="hljs-string">&quot;collections&quot;</span>, <span class="hljs-string">&quot;EnumMap&quot;</span>));<br>        System.out.println(<span class="hljs-string">&quot;collections的内容：&quot;</span>+jedis.lrange(<span class="hljs-string">&quot;collections&quot;</span>, <span class="hljs-number">0</span>, -<span class="hljs-number">1</span>));<br>        System.out.println(<span class="hljs-string">&quot;collections列表出栈（右端）：&quot;</span>+jedis.rpop(<span class="hljs-string">&quot;collections&quot;</span>));<br>        System.out.println(<span class="hljs-string">&quot;collections的内容：&quot;</span>+jedis.lrange(<span class="hljs-string">&quot;collections&quot;</span>, <span class="hljs-number">0</span>, -<span class="hljs-number">1</span>));<br>        System.out.println(<span class="hljs-string">&quot;修改collections指定下标1的内容：&quot;</span>+jedis.lset(<span class="hljs-string">&quot;collections&quot;</span>, <span class="hljs-number">1</span>, <span class="hljs-string">&quot;LinkedArrayList&quot;</span>));<br>        System.out.println(<span class="hljs-string">&quot;collections的内容：&quot;</span>+jedis.lrange(<span class="hljs-string">&quot;collections&quot;</span>, <span class="hljs-number">0</span>, -<span class="hljs-number">1</span>));<br>        System.out.println(<span class="hljs-string">&quot;===============================&quot;</span>);<br>        System.out.println(<span class="hljs-string">&quot;collections的长度：&quot;</span>+jedis.llen(<span class="hljs-string">&quot;collections&quot;</span>));<br>        System.out.println(<span class="hljs-string">&quot;获取collections下标为2的元素：&quot;</span>+jedis.lindex(<span class="hljs-string">&quot;collections&quot;</span>, <span class="hljs-number">2</span>));<br>        System.out.println(<span class="hljs-string">&quot;===============================&quot;</span>);<br>        jedis.lpush(<span class="hljs-string">&quot;sortedList&quot;</span>, <span class="hljs-string">&quot;3&quot;</span>,<span class="hljs-string">&quot;6&quot;</span>,<span class="hljs-string">&quot;2&quot;</span>,<span class="hljs-string">&quot;0&quot;</span>,<span class="hljs-string">&quot;7&quot;</span>,<span class="hljs-string">&quot;4&quot;</span>);<br>        System.out.println(<span class="hljs-string">&quot;sortedList排序前：&quot;</span>+jedis.lrange(<span class="hljs-string">&quot;sortedList&quot;</span>, <span class="hljs-number">0</span>, -<span class="hljs-number">1</span>));<br>        System.out.println(jedis.sort(<span class="hljs-string">&quot;sortedList&quot;</span>));<br>        System.out.println(<span class="hljs-string">&quot;sortedList排序后：&quot;</span>+jedis.lrange(<span class="hljs-string">&quot;sortedList&quot;</span>, <span class="hljs-number">0</span>, -<span class="hljs-number">1</span>));<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure>
<h4 id="Set">Set</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> redis.clients.jedis.Jedis;<br><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TestSet</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>        Jedis jedis = <span class="hljs-keyword">new</span> Jedis(<span class="hljs-string">&quot;127.0.0.1&quot;</span>, <span class="hljs-number">6379</span>);<br>        jedis.flushDB();<br>        System.out.println(<span class="hljs-string">&quot;============向集合中添加元素（不重复）============&quot;</span>);<br>        System.out.println(jedis.sadd(<span class="hljs-string">&quot;eleSet&quot;</span>, <span class="hljs-string">&quot;e1&quot;</span>,<span class="hljs-string">&quot;e2&quot;</span>,<span class="hljs-string">&quot;e4&quot;</span>,<span class="hljs-string">&quot;e3&quot;</span>,<span class="hljs-string">&quot;e0&quot;</span>,<span class="hljs-string">&quot;e8&quot;</span>,<span class="hljs-string">&quot;e7&quot;</span>,<span class="hljs-string">&quot;e5&quot;</span>));<br>        System.out.println(jedis.sadd(<span class="hljs-string">&quot;eleSet&quot;</span>, <span class="hljs-string">&quot;e6&quot;</span>));<br>        System.out.println(jedis.sadd(<span class="hljs-string">&quot;eleSet&quot;</span>, <span class="hljs-string">&quot;e6&quot;</span>));<br>        System.out.println(<span class="hljs-string">&quot;eleSet的所有元素为：&quot;</span>+jedis.smembers(<span class="hljs-string">&quot;eleSet&quot;</span>));<br>        System.out.println(<span class="hljs-string">&quot;删除一个元素e0：&quot;</span>+jedis.srem(<span class="hljs-string">&quot;eleSet&quot;</span>, <span class="hljs-string">&quot;e0&quot;</span>));<br>        System.out.println(<span class="hljs-string">&quot;eleSet的所有元素为：&quot;</span>+jedis.smembers(<span class="hljs-string">&quot;eleSet&quot;</span>));<br>        System.out.println(<span class="hljs-string">&quot;删除两个元素e7和e6：&quot;</span>+jedis.srem(<span class="hljs-string">&quot;eleSet&quot;</span>, <span class="hljs-string">&quot;e7&quot;</span>,<span class="hljs-string">&quot;e6&quot;</span>));<br>        System.out.println(<span class="hljs-string">&quot;eleSet的所有元素为：&quot;</span>+jedis.smembers(<span class="hljs-string">&quot;eleSet&quot;</span>));<br>        System.out.println(<span class="hljs-string">&quot;随机的移除集合中的一个元素：&quot;</span>+jedis.spop(<span class="hljs-string">&quot;eleSet&quot;</span>));<br>        System.out.println(<span class="hljs-string">&quot;随机的移除集合中的一个元素：&quot;</span>+jedis.spop(<span class="hljs-string">&quot;eleSet&quot;</span>));<br>        System.out.println(<span class="hljs-string">&quot;eleSet的所有元素为：&quot;</span>+jedis.smembers(<span class="hljs-string">&quot;eleSet&quot;</span>));<br>        System.out.println(<span class="hljs-string">&quot;eleSet中包含元素的个数：&quot;</span>+jedis.scard(<span class="hljs-string">&quot;eleSet&quot;</span>));<br>        System.out.println(<span class="hljs-string">&quot;e3是否在eleSet中：&quot;</span>+jedis.sismember(<span class="hljs-string">&quot;eleSet&quot;</span>, <span class="hljs-string">&quot;e3&quot;</span>));<br>        System.out.println(<span class="hljs-string">&quot;e1是否在eleSet中：&quot;</span>+jedis.sismember(<span class="hljs-string">&quot;eleSet&quot;</span>, <span class="hljs-string">&quot;e1&quot;</span>));<br>        System.out.println(<span class="hljs-string">&quot;e1是否在eleSet中：&quot;</span>+jedis.sismember(<span class="hljs-string">&quot;eleSet&quot;</span>, <span class="hljs-string">&quot;e5&quot;</span>));<br>        System.out.println(<span class="hljs-string">&quot;=================================&quot;</span>);<br>        System.out.println(jedis.sadd(<span class="hljs-string">&quot;eleSet1&quot;</span>, <span class="hljs-string">&quot;e1&quot;</span>,<span class="hljs-string">&quot;e2&quot;</span>,<span class="hljs-string">&quot;e4&quot;</span>,<span class="hljs-string">&quot;e3&quot;</span>,<span class="hljs-string">&quot;e0&quot;</span>,<span class="hljs-string">&quot;e8&quot;</span>,<span class="hljs-string">&quot;e7&quot;</span>,<span class="hljs-string">&quot;e5&quot;</span>));<br>        System.out.println(jedis.sadd(<span class="hljs-string">&quot;eleSet2&quot;</span>, <span class="hljs-string">&quot;e1&quot;</span>,<span class="hljs-string">&quot;e2&quot;</span>,<span class="hljs-string">&quot;e4&quot;</span>,<span class="hljs-string">&quot;e3&quot;</span>,<span class="hljs-string">&quot;e0&quot;</span>,<span class="hljs-string">&quot;e8&quot;</span>));<br>        System.out.println(<span class="hljs-string">&quot;将eleSet1中删除e1并存入eleSet3中：&quot;</span>+jedis.smove(<span class="hljs-string">&quot;eleSet1&quot;</span>, <span class="hljs-string">&quot;eleSet3&quot;</span>, <span class="hljs-string">&quot;e1&quot;</span>));<span class="hljs-comment">//移到集合元素</span><br>        System.out.println(<span class="hljs-string">&quot;将eleSet1中删除e2并存入eleSet3中：&quot;</span>+jedis.smove(<span class="hljs-string">&quot;eleSet1&quot;</span>, <span class="hljs-string">&quot;eleSet3&quot;</span>, <span class="hljs-string">&quot;e2&quot;</span>));<br>        System.out.println(<span class="hljs-string">&quot;eleSet1中的元素：&quot;</span>+jedis.smembers(<span class="hljs-string">&quot;eleSet1&quot;</span>));<br>        System.out.println(<span class="hljs-string">&quot;eleSet3中的元素：&quot;</span>+jedis.smembers(<span class="hljs-string">&quot;eleSet3&quot;</span>));<br>        System.out.println(<span class="hljs-string">&quot;============集合运算=================&quot;</span>);<br>        System.out.println(<span class="hljs-string">&quot;eleSet1中的元素：&quot;</span>+jedis.smembers(<span class="hljs-string">&quot;eleSet1&quot;</span>));<br>        System.out.println(<span class="hljs-string">&quot;eleSet2中的元素：&quot;</span>+jedis.smembers(<span class="hljs-string">&quot;eleSet2&quot;</span>));<br>        System.out.println(<span class="hljs-string">&quot;eleSet1和eleSet2的交集:&quot;</span>+jedis.sinter(<span class="hljs-string">&quot;eleSet1&quot;</span>,<span class="hljs-string">&quot;eleSet2&quot;</span>));<br>        System.out.println(<span class="hljs-string">&quot;eleSet1和eleSet2的并集:&quot;</span>+jedis.sunion(<span class="hljs-string">&quot;eleSet1&quot;</span>,<span class="hljs-string">&quot;eleSet2&quot;</span>));<br>        System.out.println(<span class="hljs-string">&quot;eleSet1和eleSet2的差集:&quot;</span>+jedis.sdiff(<span class="hljs-string">&quot;eleSet1&quot;</span>,<span class="hljs-string">&quot;eleSet2&quot;</span>));<span class="hljs-comment">//eleSet1中有，eleSet2中没有</span><br>        jedis.sinterstore(<span class="hljs-string">&quot;eleSet4&quot;</span>,<span class="hljs-string">&quot;eleSet1&quot;</span>,<span class="hljs-string">&quot;eleSet2&quot;</span>);<span class="hljs-comment">//求交集并将交集保存到dstkey的集合</span><br>        System.out.println(<span class="hljs-string">&quot;eleSet4中的元素：&quot;</span>+jedis.smembers(<span class="hljs-string">&quot;eleSet4&quot;</span>));<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<h4 id="Hash">Hash</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> redis.clients.jedis.Jedis;<br><br><span class="hljs-keyword">import</span> java.util.HashMap;<br><span class="hljs-keyword">import</span> java.util.Map;<br><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TestHash</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>        Jedis jedis = <span class="hljs-keyword">new</span> Jedis(<span class="hljs-string">&quot;127.0.0.1&quot;</span>, <span class="hljs-number">6379</span>);<br>        jedis.flushDB();<br>        Map&lt;String,String&gt; map = <span class="hljs-keyword">new</span> HashMap&lt;String,String&gt;();<br>        map.put(<span class="hljs-string">&quot;key1&quot;</span>,<span class="hljs-string">&quot;value1&quot;</span>);<br>        map.put(<span class="hljs-string">&quot;key2&quot;</span>,<span class="hljs-string">&quot;value2&quot;</span>);<br>        map.put(<span class="hljs-string">&quot;key3&quot;</span>,<span class="hljs-string">&quot;value3&quot;</span>);<br>        map.put(<span class="hljs-string">&quot;key4&quot;</span>,<span class="hljs-string">&quot;value4&quot;</span>);<br>        <span class="hljs-comment">//添加名称为hash（key）的hash元素</span><br>        jedis.hmset(<span class="hljs-string">&quot;hash&quot;</span>,map);<br>        <span class="hljs-comment">//向名称为hash的hash中添加key为key5，value为value5元素</span><br>        jedis.hset(<span class="hljs-string">&quot;hash&quot;</span>, <span class="hljs-string">&quot;key5&quot;</span>, <span class="hljs-string">&quot;value5&quot;</span>);<br>        System.out.println(<span class="hljs-string">&quot;散列hash的所有键值对为：&quot;</span>+jedis.hgetAll(<span class="hljs-string">&quot;hash&quot;</span>));<span class="hljs-comment">//return Map&lt;String,String&gt;</span><br>        System.out.println(<span class="hljs-string">&quot;散列hash的所有键为：&quot;</span>+jedis.hkeys(<span class="hljs-string">&quot;hash&quot;</span>));<span class="hljs-comment">//return Set&lt;String&gt;</span><br>        System.out.println(<span class="hljs-string">&quot;散列hash的所有值为：&quot;</span>+jedis.hvals(<span class="hljs-string">&quot;hash&quot;</span>));<span class="hljs-comment">//return List&lt;String&gt;</span><br>        System.out.println(<span class="hljs-string">&quot;将key6保存的值加上一个整数，如果key6不存在则添加key6：&quot;</span>+jedis.hincrBy(<span class="hljs-string">&quot;hash&quot;</span>, <span class="hljs-string">&quot;key6&quot;</span>, <span class="hljs-number">6</span>));<br>        System.out.println(<span class="hljs-string">&quot;散列hash的所有键值对为：&quot;</span>+jedis.hgetAll(<span class="hljs-string">&quot;hash&quot;</span>));<br>        System.out.println(<span class="hljs-string">&quot;将key6保存的值加上一个整数，如果key6不存在则添加key6：&quot;</span>+jedis.hincrBy(<span class="hljs-string">&quot;hash&quot;</span>, <span class="hljs-string">&quot;key6&quot;</span>, <span class="hljs-number">3</span>));<br>        System.out.println(<span class="hljs-string">&quot;散列hash的所有键值对为：&quot;</span>+jedis.hgetAll(<span class="hljs-string">&quot;hash&quot;</span>));<br>        System.out.println(<span class="hljs-string">&quot;删除一个或者多个键值对：&quot;</span>+jedis.hdel(<span class="hljs-string">&quot;hash&quot;</span>, <span class="hljs-string">&quot;key2&quot;</span>));<br>        System.out.println(<span class="hljs-string">&quot;散列hash的所有键值对为：&quot;</span>+jedis.hgetAll(<span class="hljs-string">&quot;hash&quot;</span>));<br>        System.out.println(<span class="hljs-string">&quot;散列hash中键值对的个数：&quot;</span>+jedis.hlen(<span class="hljs-string">&quot;hash&quot;</span>));<br>        System.out.println(<span class="hljs-string">&quot;判断hash中是否存在key2：&quot;</span>+jedis.hexists(<span class="hljs-string">&quot;hash&quot;</span>,<span class="hljs-string">&quot;key2&quot;</span>));<br>        System.out.println(<span class="hljs-string">&quot;判断hash中是否存在key3：&quot;</span>+jedis.hexists(<span class="hljs-string">&quot;hash&quot;</span>,<span class="hljs-string">&quot;key3&quot;</span>));<br>        System.out.println(<span class="hljs-string">&quot;获取hash中的值：&quot;</span>+jedis.hmget(<span class="hljs-string">&quot;hash&quot;</span>,<span class="hljs-string">&quot;key3&quot;</span>));<br>        System.out.println(<span class="hljs-string">&quot;获取hash中的值：&quot;</span>+jedis.hmget(<span class="hljs-string">&quot;hash&quot;</span>,<span class="hljs-string">&quot;key3&quot;</span>,<span class="hljs-string">&quot;key4&quot;</span>));<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure>
<h4 id="Key">Key</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> redis.clients.jedis.Jedis;<br><br><span class="hljs-keyword">import</span> java.util.Set;<br><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TestKey</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>        Jedis jedis = <span class="hljs-keyword">new</span> Jedis(<span class="hljs-string">&quot;127.0.0.1&quot;</span>, <span class="hljs-number">6379</span>);<br><br>        System.out.println(<span class="hljs-string">&quot;清空数据：&quot;</span>+jedis.flushDB());<br>        System.out.println(<span class="hljs-string">&quot;判断某个键是否存在：&quot;</span>+jedis.exists(<span class="hljs-string">&quot;username&quot;</span>));<br>        System.out.println(<span class="hljs-string">&quot;新增&lt;&#x27;username&#x27;,&#x27;kuangshen&#x27;&gt;的键值对：&quot;</span>+jedis.set(<span class="hljs-string">&quot;username&quot;</span>, <span class="hljs-string">&quot;kuangshen&quot;</span>));<br>        System.out.println(<span class="hljs-string">&quot;新增&lt;&#x27;password&#x27;,&#x27;password&#x27;&gt;的键值对：&quot;</span>+jedis.set(<span class="hljs-string">&quot;password&quot;</span>, <span class="hljs-string">&quot;password&quot;</span>));<br>        System.out.print(<span class="hljs-string">&quot;系统中所有的键如下：&quot;</span>);<br>        Set&lt;String&gt; keys = jedis.keys(<span class="hljs-string">&quot;*&quot;</span>);<br>        System.out.println(keys);<br>        System.out.println(<span class="hljs-string">&quot;删除键password:&quot;</span>+jedis.del(<span class="hljs-string">&quot;password&quot;</span>));<br>        System.out.println(<span class="hljs-string">&quot;判断键password是否存在：&quot;</span>+jedis.exists(<span class="hljs-string">&quot;password&quot;</span>));<br>        System.out.println(<span class="hljs-string">&quot;查看键username所存储的值的类型：&quot;</span>+jedis.type(<span class="hljs-string">&quot;username&quot;</span>));<br>        System.out.println(<span class="hljs-string">&quot;随机返回key空间的一个：&quot;</span>+jedis.randomKey());<br>        System.out.println(<span class="hljs-string">&quot;重命名key：&quot;</span>+jedis.rename(<span class="hljs-string">&quot;username&quot;</span>,<span class="hljs-string">&quot;name&quot;</span>));<br>        System.out.println(<span class="hljs-string">&quot;取出改后的name：&quot;</span>+jedis.get(<span class="hljs-string">&quot;name&quot;</span>));<br>        System.out.println(<span class="hljs-string">&quot;按索引查询：&quot;</span>+jedis.select(<span class="hljs-number">0</span>));<br>        System.out.println(<span class="hljs-string">&quot;删除当前选择数据库中的所有key：&quot;</span>+jedis.flushDB());<br>        System.out.println(<span class="hljs-string">&quot;返回当前数据库中key的数目：&quot;</span>+jedis.dbSize());<br>        System.out.println(<span class="hljs-string">&quot;删除所有数据库中的所有key：&quot;</span>+jedis.flushAll());<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure>
<h4 id="Password">Password</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> redis.clients.jedis.Jedis;<br><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TestPassword</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>        Jedis jedis = <span class="hljs-keyword">new</span> Jedis(<span class="hljs-string">&quot;127.0.0.1&quot;</span>, <span class="hljs-number">6379</span>);<br><br>        <span class="hljs-comment">//验证密码，如果没有设置密码这段代码省略</span><br><span class="hljs-comment">//        jedis.auth(&quot;password&quot;);</span><br><br>        jedis.connect(); <span class="hljs-comment">//连接</span><br>        jedis.disconnect(); <span class="hljs-comment">//断开连接</span><br><br>        jedis.flushAll(); <span class="hljs-comment">//清空所有的key</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<h3 id="3、事务">3、事务</h3>
<p>让我们看看在boot里面如何使用事务</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> com.alibaba.fastjson.JSONObject;<br><span class="hljs-keyword">import</span> redis.clients.jedis.Jedis;<br><span class="hljs-keyword">import</span> redis.clients.jedis.Transaction;<br><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TestMulti</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>        <span class="hljs-comment">//创建客户端连接服务端，redis服务端需要被开启</span><br>        Jedis jedis = <span class="hljs-keyword">new</span> Jedis(<span class="hljs-string">&quot;127.0.0.1&quot;</span>, <span class="hljs-number">6379</span>);<br>        jedis.flushDB();<br><br>        JSONObject jsonObject = <span class="hljs-keyword">new</span> JSONObject();<br>        jsonObject.put(<span class="hljs-string">&quot;hello&quot;</span>, <span class="hljs-string">&quot;world&quot;</span>);<br>        jsonObject.put(<span class="hljs-string">&quot;name&quot;</span>, <span class="hljs-string">&quot;java&quot;</span>);<br>        <span class="hljs-comment">//开启事务</span><br>        Transaction multi = jedis.multi();<br>        String result = jsonObject.toJSONString();<br>        <span class="hljs-keyword">try</span>&#123;<br>            <span class="hljs-comment">//向redis存入一条数据</span><br>            multi.set(<span class="hljs-string">&quot;json&quot;</span>, result);<br>            <span class="hljs-comment">//再存入一条数据</span><br>            multi.set(<span class="hljs-string">&quot;json2&quot;</span>, result);<br>            <span class="hljs-comment">//这里引发了异常，用0作为被除数</span><br>            <span class="hljs-keyword">int</span> i = <span class="hljs-number">100</span>/<span class="hljs-number">0</span>;<br>            <span class="hljs-comment">//如果没有引发异常，执行进入队列的命令</span><br>            multi.exec();<br>        &#125;<span class="hljs-keyword">catch</span>(Exception e)&#123;<br>            e.printStackTrace();<br>            <span class="hljs-comment">//如果出现异常，回滚</span><br>            multi.discard();<br>        &#125;<span class="hljs-keyword">finally</span>&#123;<br>            System.out.println(jedis.get(<span class="hljs-string">&quot;json&quot;</span>));<br>            System.out.println(jedis.get(<span class="hljs-string">&quot;json2&quot;</span>));<br>            <span class="hljs-comment">//最终关闭客户端</span><br>            jedis.close();<br>        &#125;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure>
<h3 id="4、Springboot-整合">4、Springboot 整合</h3>
<p>在spring boot2.x之后，原来使用的jedis被替换成了lettuce</p>
<ul>
<li>
<p>jedis所采用的直连，多个线程操作的时候不安全，如果想要追求安全 ，可以使用jedis pool连接池</p>
</li>
<li>
<p>lettuce 采用netty 实例可以在多个线程中进行共享，不存在线程不安全的情况，更像NIO</p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Bean</span><br><span class="hljs-meta">@ConditionalOnMissingBean(</span><br><span class="hljs-meta">    name = &#123;&quot;redisTemplate&quot;&#125;</span><br><span class="hljs-meta">)</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> RedisTemplate&lt;Object, Object&gt; <span class="hljs-title">redisTemplate</span><span class="hljs-params">(RedisConnectionFactory redisConnectionFactory)</span> <span class="hljs-keyword">throws</span> UnknownHostException </span>&#123;<br>    <span class="hljs-comment">//两个泛型都是object 类，我们后使用需要强制转换</span><br>    RedisTemplate&lt;Object, Object&gt; template = <span class="hljs-keyword">new</span> RedisTemplate();<br>    template.setConnectionFactory(redisConnectionFactory);<br>    <span class="hljs-keyword">return</span> template;<br>&#125;<br><br><span class="hljs-meta">@Bean</span><br><span class="hljs-meta">@ConditionalOnMissingBean</span><span class="hljs-comment">//由于String时redis最常使用的类型，所以单独提出来了一个方法</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> StringRedisTemplate <span class="hljs-title">stringRedisTemplate</span><span class="hljs-params">(RedisConnectionFactory redisConnectionFactory)</span> <span class="hljs-keyword">throws</span> UnknownHostException </span>&#123;<br>    StringRedisTemplate template = <span class="hljs-keyword">new</span> StringRedisTemplate();<br>    template.setConnectionFactory(redisConnectionFactory);<br>    <span class="hljs-keyword">return</span> template;<br>&#125;<br></code></pre></td></tr></table></figure>
<h4 id="1、整合步骤">1、整合步骤</h4>
<p>1.导入依赖    --上面的jedis的包</p>
<p>2.配置链接</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">spring:</span><br>    <span class="hljs-attr">redis:</span><br>      <span class="hljs-attr">host:</span> <span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span><br>      <span class="hljs-attr">port:</span> <span class="hljs-number">6379</span><br>      <span class="hljs-attr">password:</span> <br>      <span class="hljs-attr">jedis:</span><br>        <span class="hljs-attr">pool:</span><br>          <span class="hljs-attr">max-active:</span> <span class="hljs-number">8</span><br>          <span class="hljs-attr">max-wait:</span> <span class="hljs-string">-1ms</span><br>          <span class="hljs-attr">max-idle:</span> <span class="hljs-number">500</span><br>          <span class="hljs-attr">min-idle:</span> <span class="hljs-number">0</span><br>      <span class="hljs-attr">lettuce:</span><br>        <span class="hljs-attr">shutdown-timeout:</span> <span class="hljs-string">0ms</span><br></code></pre></td></tr></table></figure>
<p>3.测试</p>
<h4 id="2、编写自己的-redisTemplate">2、编写自己的 redisTemplate</h4>
<p>这里需要注意一下要直接传输对象的话需要将对象序列化，比如下面这样讲pojo的类实现序列化的接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">user</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Serializer</span></span>&#123;<br>    <span class="hljs-keyword">int</span> age;<br>    String name;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>自己的template</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> com.fasterxml.jackson.annotation.JsonAutoDetect;<br><span class="hljs-keyword">import</span> com.fasterxml.jackson.annotation.PropertyAccessor;<br><span class="hljs-keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;<br><span class="hljs-keyword">import</span> org.springframework.context.annotation.Bean;<br><span class="hljs-keyword">import</span> org.springframework.context.annotation.Configuration;<br><span class="hljs-keyword">import</span> org.springframework.data.redis.connection.RedisConnectionFactory;<br><span class="hljs-keyword">import</span> org.springframework.data.redis.core.RedisTemplate;<br><span class="hljs-keyword">import</span> org.springframework.data.redis.serializer.Jackson2JsonRedisSerializer;<br><span class="hljs-keyword">import</span> org.springframework.data.redis.serializer.StringRedisSerializer;<br><br><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RedisConfig</span> </span>&#123;<br><br>  <span class="hljs-meta">@Bean</span><br>  <span class="hljs-meta">@SuppressWarnings(&quot;all&quot;)</span><br>  <span class="hljs-function"><span class="hljs-keyword">public</span> RedisTemplate&lt;String, Object&gt; <span class="hljs-title">redisTemplate</span><span class="hljs-params">(RedisConnectionFactory factory)</span> </span>&#123;<br>      RedisTemplate&lt;String, Object&gt; template = <span class="hljs-keyword">new</span> RedisTemplate&lt;String, Object&gt;();<br><br>      template.setConnectionFactory(factory);<br><br>      <span class="hljs-comment">//序列化配置</span><br>      Jackson2JsonRedisSerializer jackson2JsonRedisSerializer = <span class="hljs-keyword">new</span> Jackson2JsonRedisSerializer(Object.class);<br><br>      ObjectMapper om = <span class="hljs-keyword">new</span> ObjectMapper();<br>      om.setVisibility(PropertyAccessor.ALL, JsonAutoDetect.Visibility.ANY);<br>      om.enableDefaultTyping(ObjectMapper.DefaultTyping.NON_FINAL);<br>      jackson2JsonRedisSerializer.setObjectMapper(om);<br><br>      <span class="hljs-comment">//String序列化</span><br>      StringRedisSerializer stringRedisSerializer = <span class="hljs-keyword">new</span> StringRedisSerializer();<br><br>      <span class="hljs-comment">// key采用String的序列化方式</span><br>      template.setKeySerializer(stringRedisSerializer);<br>      <span class="hljs-comment">// hash的key也采用String的序列化方式</span><br>      template.setHashKeySerializer(stringRedisSerializer);<br>      <span class="hljs-comment">// value序列化方式采用jackson</span><br>      template.setValueSerializer(jackson2JsonRedisSerializer);<br>      <span class="hljs-comment">// hash的value序列化方式采用jackson</span><br>      template.setHashValueSerializer(jackson2JsonRedisSerializer);<br>      template.afterPropertiesSet();<br><br>      <span class="hljs-keyword">return</span> template;<br>  &#125;<br><br><br>&#125;<br></code></pre></td></tr></table></figure>
<p>使用工具类封装</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;<br><span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Qualifier;<br><span class="hljs-keyword">import</span> org.springframework.data.redis.core.RedisTemplate;<br><span class="hljs-keyword">import</span> org.springframework.stereotype.Component;<br><span class="hljs-keyword">import</span> org.springframework.util.CollectionUtils;<br><br><span class="hljs-keyword">import</span> java.util.List;<br><span class="hljs-keyword">import</span> java.util.Map;<br><span class="hljs-keyword">import</span> java.util.Set;<br><span class="hljs-keyword">import</span> java.util.concurrent.TimeUnit;<br><br><span class="hljs-meta">@Component</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RedisUtil</span> </span>&#123;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-meta">@Qualifier(&quot;redisTemplate&quot;)</span><span class="hljs-comment">//指定那个redisTemplate,可以不写</span><br>    <span class="hljs-keyword">private</span> RedisTemplate&lt;String, Object&gt; redisTemplate;<br><br>    <span class="hljs-comment">// =============================common============================</span><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 指定缓存失效时间</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> key  键</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> time 时间(秒)</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">expire</span><span class="hljs-params">(String key, <span class="hljs-keyword">long</span> time)</span> </span>&#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-keyword">if</span> (time &gt; <span class="hljs-number">0</span>) &#123;<br>                redisTemplate.expire(key, time, TimeUnit.SECONDS);<br>            &#125;<br>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            e.printStackTrace();<br>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 根据key 获取过期时间</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> key 键 不能为null</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> 时间(秒) 返回0代表为永久有效</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">long</span> <span class="hljs-title">getExpire</span><span class="hljs-params">(String key)</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> redisTemplate.getExpire(key, TimeUnit.SECONDS);<br>    &#125;<br><br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 判断key是否存在</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> key 键</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> true 存在 false不存在</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">hasKey</span><span class="hljs-params">(String key)</span> </span>&#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-keyword">return</span> redisTemplate.hasKey(key);<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            e.printStackTrace();<br>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;<br>        &#125;<br>    &#125;<br><br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 删除缓存</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> key 可以传一个值 或多个</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@SuppressWarnings(&quot;unchecked&quot;)</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">del</span><span class="hljs-params">(String... key)</span> </span>&#123;<br>        <span class="hljs-keyword">if</span> (key != <span class="hljs-keyword">null</span> &amp;&amp; key.length &gt; <span class="hljs-number">0</span>) &#123;<br>            <span class="hljs-keyword">if</span> (key.length == <span class="hljs-number">1</span>) &#123;<br>                redisTemplate.delete(key[<span class="hljs-number">0</span>]);<br>            &#125; <span class="hljs-keyword">else</span> &#123;<br>                redisTemplate.delete(CollectionUtils.arrayToList(key));<br>            &#125;<br>        &#125;<br>    &#125;<br><br><br>    <span class="hljs-comment">// ============================String=============================</span><br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 普通缓存获取</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> key 键</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> 值</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> Object <span class="hljs-title">get</span><span class="hljs-params">(String key)</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> key == <span class="hljs-keyword">null</span> ? <span class="hljs-keyword">null</span> : redisTemplate.opsForValue().get(key);<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 普通缓存放入</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> key   键</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> value 值</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> true成功 false失败</span><br><span class="hljs-comment">     */</span><br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">set</span><span class="hljs-params">(String key, Object value)</span> </span>&#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            redisTemplate.opsForValue().set(key, value);<br>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            e.printStackTrace();<br>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;<br>        &#125;<br>    &#125;<br><br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 普通缓存放入并设置时间</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> key   键</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> value 值</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> time  时间(秒) time要大于0 如果time小于等于0 将设置无限期</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> true成功 false 失败</span><br><span class="hljs-comment">     */</span><br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">set</span><span class="hljs-params">(String key, Object value, <span class="hljs-keyword">long</span> time)</span> </span>&#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-keyword">if</span> (time &gt; <span class="hljs-number">0</span>) &#123;<br>                redisTemplate.opsForValue().set(key, value, time, TimeUnit.SECONDS);<br>            &#125; <span class="hljs-keyword">else</span> &#123;<br>                set(key, value);<br>            &#125;<br>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            e.printStackTrace();<br>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;<br>        &#125;<br>    &#125;<br><br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 递增</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> key   键</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> delta 要增加几(大于0)</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">long</span> <span class="hljs-title">incr</span><span class="hljs-params">(String key, <span class="hljs-keyword">long</span> delta)</span> </span>&#123;<br>        <span class="hljs-keyword">if</span> (delta &lt; <span class="hljs-number">0</span>) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> RuntimeException(<span class="hljs-string">&quot;递增因子必须大于0&quot;</span>);<br>        &#125;<br>        <span class="hljs-keyword">return</span> redisTemplate.opsForValue().increment(key, delta);<br>    &#125;<br><br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 递减</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> key   键</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> delta 要减少几(小于0)</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">long</span> <span class="hljs-title">decr</span><span class="hljs-params">(String key, <span class="hljs-keyword">long</span> delta)</span> </span>&#123;<br>        <span class="hljs-keyword">if</span> (delta &lt; <span class="hljs-number">0</span>) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> RuntimeException(<span class="hljs-string">&quot;递减因子必须大于0&quot;</span>);<br>        &#125;<br>        <span class="hljs-keyword">return</span> redisTemplate.opsForValue().increment(key, -delta);<br>    &#125;<br><br><br>    <span class="hljs-comment">// ================================Map=================================</span><br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * HashGet</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> key  键 不能为null</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> item 项 不能为null</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> Object <span class="hljs-title">hget</span><span class="hljs-params">(String key, String item)</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> redisTemplate.opsForHash().get(key, item);<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 获取hashKey对应的所有键值</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> key 键</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> 对应的多个键值</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> Map&lt;Object, Object&gt; <span class="hljs-title">hmget</span><span class="hljs-params">(String key)</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> redisTemplate.opsForHash().entries(key);<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * HashSet</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> key 键</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> map 对应多个键值</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">hmset</span><span class="hljs-params">(String key, Map&lt;String, Object&gt; map)</span> </span>&#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            redisTemplate.opsForHash().putAll(key, map);<br>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            e.printStackTrace();<br>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;<br>        &#125;<br>    &#125;<br><br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * HashSet 并设置时间</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> key  键</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> map  对应多个键值</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> time 时间(秒)</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> true成功 false失败</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">hmset</span><span class="hljs-params">(String key, Map&lt;String, Object&gt; map, <span class="hljs-keyword">long</span> time)</span> </span>&#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            redisTemplate.opsForHash().putAll(key, map);<br>            <span class="hljs-keyword">if</span> (time &gt; <span class="hljs-number">0</span>) &#123;<br>                expire(key, time);<br>            &#125;<br>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            e.printStackTrace();<br>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;<br>        &#125;<br>    &#125;<br><br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 向一张hash表中放入数据,如果不存在将创建</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> key   键</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> item  项</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> value 值</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> true 成功 false失败</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">hset</span><span class="hljs-params">(String key, String item, Object value)</span> </span>&#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            redisTemplate.opsForHash().put(key, item, value);<br>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            e.printStackTrace();<br>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 向一张hash表中放入数据,如果不存在将创建</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> key   键</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> item  项</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> value 值</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> time  时间(秒) 注意:如果已存在的hash表有时间,这里将会替换原有的时间</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> true 成功 false失败</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">hset</span><span class="hljs-params">(String key, String item, Object value, <span class="hljs-keyword">long</span> time)</span> </span>&#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            redisTemplate.opsForHash().put(key, item, value);<br>            <span class="hljs-keyword">if</span> (time &gt; <span class="hljs-number">0</span>) &#123;<br>                expire(key, time);<br>            &#125;<br>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            e.printStackTrace();<br>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;<br>        &#125;<br>    &#125;<br><br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 删除hash表中的值</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> key  键 不能为null</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> item 项 可以使多个 不能为null</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">hdel</span><span class="hljs-params">(String key, Object... item)</span> </span>&#123;<br>        redisTemplate.opsForHash().delete(key, item);<br>    &#125;<br><br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 判断hash表中是否有该项的值</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> key  键 不能为null</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> item 项 不能为null</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> true 存在 false不存在</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">hHasKey</span><span class="hljs-params">(String key, String item)</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> redisTemplate.opsForHash().hasKey(key, item);<br>    &#125;<br><br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * hash递增 如果不存在,就会创建一个 并把新增后的值返回</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> key  键</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> item 项</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> by   要增加几(大于0)</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">double</span> <span class="hljs-title">hincr</span><span class="hljs-params">(String key, String item, <span class="hljs-keyword">double</span> by)</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> redisTemplate.opsForHash().increment(key, item, by);<br>    &#125;<br><br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * hash递减</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> key  键</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> item 项</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> by   要减少记(小于0)</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">double</span> <span class="hljs-title">hdecr</span><span class="hljs-params">(String key, String item, <span class="hljs-keyword">double</span> by)</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> redisTemplate.opsForHash().increment(key, item, -by);<br>    &#125;<br><br><br>    <span class="hljs-comment">// ============================set=============================</span><br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 根据key获取Set中的所有值</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> key 键</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> Set&lt;Object&gt; <span class="hljs-title">sGet</span><span class="hljs-params">(String key)</span> </span>&#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-keyword">return</span> redisTemplate.opsForSet().members(key);<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            e.printStackTrace();<br>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;<br>        &#125;<br>    &#125;<br><br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 根据value从一个set中查询,是否存在</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> key   键</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> value 值</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> true 存在 false不存在</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">sHasKey</span><span class="hljs-params">(String key, Object value)</span> </span>&#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-keyword">return</span> redisTemplate.opsForSet().isMember(key, value);<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            e.printStackTrace();<br>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;<br>        &#125;<br>    &#125;<br><br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 将数据放入set缓存</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> key    键</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> values 值 可以是多个</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> 成功个数</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">long</span> <span class="hljs-title">sSet</span><span class="hljs-params">(String key, Object... values)</span> </span>&#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-keyword">return</span> redisTemplate.opsForSet().add(key, values);<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            e.printStackTrace();<br>            <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>        &#125;<br>    &#125;<br><br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 将set数据放入缓存</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> key    键</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> time   时间(秒)</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> values 值 可以是多个</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> 成功个数</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">long</span> <span class="hljs-title">sSetAndTime</span><span class="hljs-params">(String key, <span class="hljs-keyword">long</span> time, Object... values)</span> </span>&#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            Long count = redisTemplate.opsForSet().add(key, values);<br>            <span class="hljs-keyword">if</span> (time &gt; <span class="hljs-number">0</span>)<br>                expire(key, time);<br>            <span class="hljs-keyword">return</span> count;<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            e.printStackTrace();<br>            <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>        &#125;<br>    &#125;<br><br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 获取set缓存的长度</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> key 键</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">long</span> <span class="hljs-title">sGetSetSize</span><span class="hljs-params">(String key)</span> </span>&#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-keyword">return</span> redisTemplate.opsForSet().size(key);<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            e.printStackTrace();<br>            <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>        &#125;<br>    &#125;<br><br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 移除值为value的</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> key    键</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> values 值 可以是多个</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> 移除的个数</span><br><span class="hljs-comment">     */</span><br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">long</span> <span class="hljs-title">setRemove</span><span class="hljs-params">(String key, Object... values)</span> </span>&#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            Long count = redisTemplate.opsForSet().remove(key, values);<br>            <span class="hljs-keyword">return</span> count;<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            e.printStackTrace();<br>            <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-comment">// ===============================list=================================</span><br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 获取list缓存的内容</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> key   键</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> start 开始</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> end   结束 0 到 -1代表所有值</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;Object&gt; <span class="hljs-title">lGet</span><span class="hljs-params">(String key, <span class="hljs-keyword">long</span> start, <span class="hljs-keyword">long</span> end)</span> </span>&#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-keyword">return</span> redisTemplate.opsForList().range(key, start, end);<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            e.printStackTrace();<br>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;<br>        &#125;<br>    &#125;<br><br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 获取list缓存的长度</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> key 键</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">long</span> <span class="hljs-title">lGetListSize</span><span class="hljs-params">(String key)</span> </span>&#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-keyword">return</span> redisTemplate.opsForList().size(key);<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            e.printStackTrace();<br>            <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>        &#125;<br>    &#125;<br><br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 通过索引 获取list中的值</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> key   键</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> index 索引 index&gt;=0时， 0 表头，1 第二个元素，依次类推；index&lt;0时，-1，表尾，-2倒数第二个元素，依次类推</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> Object <span class="hljs-title">lGetIndex</span><span class="hljs-params">(String key, <span class="hljs-keyword">long</span> index)</span> </span>&#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-keyword">return</span> redisTemplate.opsForList().index(key, index);<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            e.printStackTrace();<br>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;<br>        &#125;<br>    &#125;<br><br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 将list放入缓存</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> key   键</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> value 值</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">lSet</span><span class="hljs-params">(String key, Object value)</span> </span>&#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            redisTemplate.opsForList().rightPush(key, value);<br>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            e.printStackTrace();<br>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;<br>        &#125;<br>    &#125;<br><br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 将list放入缓存</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> key   键</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> value 值</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> time  时间(秒)</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">lSet</span><span class="hljs-params">(String key, Object value, <span class="hljs-keyword">long</span> time)</span> </span>&#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            redisTemplate.opsForList().rightPush(key, value);<br>            <span class="hljs-keyword">if</span> (time &gt; <span class="hljs-number">0</span>)<br>                expire(key, time);<br>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            e.printStackTrace();<br>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;<br>        &#125;<br><br>    &#125;<br><br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 将list放入缓存</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> key   键</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> value 值</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">lSet</span><span class="hljs-params">(String key, List&lt;Object&gt; value)</span> </span>&#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            redisTemplate.opsForList().rightPushAll(key, value);<br>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            e.printStackTrace();<br>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;<br>        &#125;<br><br>    &#125;<br><br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 将list放入缓存</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> key   键</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> value 值</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> time  时间(秒)</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">lSet</span><span class="hljs-params">(String key, List&lt;Object&gt; value, <span class="hljs-keyword">long</span> time)</span> </span>&#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            redisTemplate.opsForList().rightPushAll(key, value);<br>            <span class="hljs-keyword">if</span> (time &gt; <span class="hljs-number">0</span>)<br>                expire(key, time);<br>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            e.printStackTrace();<br>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;<br>        &#125;<br>    &#125;<br><br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 根据索引修改list中的某条数据</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> key   键</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> index 索引</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> value 值</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">lUpdateIndex</span><span class="hljs-params">(String key, <span class="hljs-keyword">long</span> index, Object value)</span> </span>&#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            redisTemplate.opsForList().set(key, index, value);<br>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            e.printStackTrace();<br>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;<br>        &#125;<br>    &#125;<br><br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 移除N个值为value</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> key   键</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> count 移除多少个</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> value 值</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> 移除的个数</span><br><span class="hljs-comment">     */</span><br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">long</span> <span class="hljs-title">lRemove</span><span class="hljs-params">(String key, <span class="hljs-keyword">long</span> count, Object value)</span> </span>&#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            Long remove = redisTemplate.opsForList().remove(key, count, value);<br>            <span class="hljs-keyword">return</span> remove;<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            e.printStackTrace();<br>            <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>        &#125;<br><br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>
<p>测试</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Autowird</span><br><span class="hljs-keyword">private</span> RedisUtil redisUtil; <span class="hljs-comment">//装配工具类</span><br><br><span class="hljs-meta">@Test</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">test1</span><span class="hljs-params">()</span></span>&#123;<br>  redisUtil.set(<span class="hljs-string">&quot;name&quot;</span>,<span class="hljs-string">&quot;chenning&quot;</span>);<span class="hljs-comment">//直接使用就行</span><br>  System.out.println(redisUtil.get(<span class="hljs-string">&quot;name&quot;</span>));<br>&#125;<br></code></pre></td></tr></table></figure>
<p>重要的是去理解redis的思想和使用情景</p>
<h2 id="九、redis-conf详解">九、redis.conf详解</h2>
<p>文件的位置<p class="label label-success">默认路径 /usr/local/bin/Nconfig</p></p>
<p><img src="https://cdn.jsdelivr.net/gh/52HZMercury/img/blog/image-20220414174009767.png" srcset="/img/newloading.gif" lazyload alt="image-20220414174009767"></p>
<p>配置文件对于大小写不敏感</p>
<h3 id="1、包含-INCLUDES">1、包含 INCLUDES</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">include /path/to/local.conf<br><br>include /path/to/other.conf<br></code></pre></td></tr></table></figure>
<p>好比是spring里面的import</p>
<h3 id="2、网络-NETWORK">2、网络 NETWORK</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">bind</span> 127.0.0.1 -::1<br><br><br><span class="hljs-comment"># 是否开启保护模式</span><br>protected-mode yes<br><br><br><span class="hljs-comment"># 端口设置</span><br>port 6379<br></code></pre></td></tr></table></figure>
<h3 id="3、通用配置-GENERAL">3、通用配置 GENERAL</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 以守护进程的方式进行</span><br>daemonize yes  <br><span class="hljs-comment"># 默认是关闭的，我们这里选择开启</span><br><br><br><br><span class="hljs-comment"># 如果以后台的形式运行 需要指定一个pid文件</span><br>pidfile /var/run/redis_6379.pid<br><br><br><br><span class="hljs-comment"># 日志</span><br><span class="hljs-comment"># Specify the server verbosity level.</span><br><span class="hljs-comment"># This can be one of:</span><br><span class="hljs-comment"># debug (a lot of information, useful for development/testing)</span><br><span class="hljs-comment"># verbose (many rarely useful info, but not a mess like the debug level)</span><br><span class="hljs-comment"># notice (moderately verbose, what you want in production probably)</span><br><span class="hljs-comment"># warning (only very important / critical messages are logged)</span><br>    <br>loglevel notice<br><br><span class="hljs-comment">#日志文件位置名</span><br>logfile <span class="hljs-string">&quot;&quot;</span><br>    <br><span class="hljs-comment">#默认库的数量是16个</span><br>databases 16<br></code></pre></td></tr></table></figure>
<h3 id="4、快照-SNAPSHOT">4、快照 SNAPSHOT</h3>
<p>所谓的快照就是持久化</p>
<p>在持久化的过程中，redis中的数据会持久化到以<span class="label label-primary"> .rdb </span>或者<span class="label label-primary"> .aof </span></p>
<p>因为redis是内存数据库，因此数据断电即失，所以需要隔一段时间就持久化一下</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">save 3600 1       <span class="hljs-comment"># 如果3600内有1次修改数据就持久化一次</span><br><br>save 300 100      <span class="hljs-comment"># 如果300内有100次修改数据就持久化一次</span><br><br>save 60 10000     <span class="hljs-comment"># 如果60内有10000次修改数据就持久化一次</span><br></code></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">stop-writes-on-bgsave-error yes <span class="hljs-comment"># 持久化操作错误后是否操作</span><br><br>rdbcompression yes              <span class="hljs-comment"># 是否压缩持久化数据</span><br><br>rdbchecksum yes                 <span class="hljs-comment"># 持久化后是否检查</span><br><br>dir ./                          <span class="hljs-comment"># .rdb文件保存的目录</span><br></code></pre></td></tr></table></figure>
<h3 id="5、安全">5、安全</h3>
<p>限制client</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 最大的连接数</span><br><span class="hljs-comment"># maxclients 10000</span><br><br><span class="hljs-comment"># 控制节点能使用的最大内存</span><br><span class="hljs-comment"># maxmemory &lt;bytes&gt;</span><br><br><span class="hljs-comment"># 内存满之后的处理策略</span><br><span class="hljs-comment"># maxmemory-policy noeviction</span><br></code></pre></td></tr></table></figure>
<p class="note note-danger">有六种淘汰策略</p>
<ol>
<li>
<p>noeviction(默认策略)：对于写请求不再提供服务，直接返回错误（DEL请求和部分特殊请求除外）</p>
</li>
<li>
<p>allkeys-lru：从所有key中使用LRU算法进行淘汰</p>
</li>
<li>
<p>volatile-lru：从设置了过期时间的key中使用LRU算法进行淘汰</p>
</li>
<li>
<p>allkeys-random：从所有key中随机淘汰数据</p>
</li>
<li>
<p>volatile-random：从设置了过期时间的key中随机淘汰</p>
</li>
<li>
<p>volatile-ttl：在设置了过期时间的key中，淘汰过期时间剩余最短的</p>
</li>
</ol>
<h3 id="6、append-only-模式-aof配置">6、append only 模式 aof配置</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 默认使用rdb 因为完全够用 不开启aof  </span><br>appendonly no  <br><br><span class="hljs-comment"># aof文件的名字</span><br>appendfilename <span class="hljs-string">&quot;appendonly.aof&quot;</span><br><br><br><span class="hljs-comment">#下面三个只选择一个开</span><br><span class="hljs-comment"># appendfsync always  # 每次修改都会同步，但过于消耗性能</span><br><br>appendfsync everysec  <span class="hljs-comment"># 每秒执行一次同步，但会丢失这1s的数据</span><br><br><span class="hljs-comment"># appendfsync no      # 不执行同步，操作系统自己同步数据，速度最快</span><br></code></pre></td></tr></table></figure>
<h2 id="十、持久化">十、持久化</h2>
<p>持久化是 <span class="label label-danger">重点</span></p>
<p class="note note-primary">为什么需要持久化</p>
<p>redis是一个内存数据库，如果不将数据库里面的数据保存到磁盘，服务一旦停止，那么数据就会全部丢失!因此redis需要通过持久化将数据都保存下来,redis的持久化有两种方式，RDB和AOF</p>
<h3 id="1、RDB">1、RDB</h3>
<p>RDB的全程就是redis database，它通过再指定的时间间隔内将内存种的数据集快照写入磁盘，也就是snapshot快照，他恢复时是将快照文件直接读取到内存里面(感觉像是我以前写的租车管理系统😐)，Redis会单独创建(fork)一个子进程来进行持久化，会先将数据写入到一个临时文件种，待持久化过程都结束了，再用这个临时文件替换上次持久化好的文件。整个过程中，主进程时是不进行任何IO操作的。这就确保了极高的性能。如果要进行大规模数据的恢复，且对于数据恢复的完整性不是特别的敏感，那么RDB方式要比AOF方式更加的高效。RDB的缺点是最后一次持久化的数据可能会丢失，Redis默认的就是RDB，一般需要修改。</p>
<h4 id="1-1-触发机制">1.1 触发机制</h4>
<p>RDB的触发机制有下面三种</p>
<ol>
<li>
<p>save规则满足（save的配置上一节有）</p>
</li>
<li>
<p>执行flushAll 命令</p>
</li>
<li>
<p>退出redis</p>
</li>
</ol>
<h4 id="1-2-如何恢复">1.2 如何恢复</h4>
<p>这个比较容易，只需要将rdb文件放在我们的启动目录下就行，redis启动的时候会自动检查dump.rdb恢复其中的数据</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">127.0.0.1:6379&gt; config get dir  <span class="hljs-comment">#输入这个指令就可以得到启动目录，将rdb放里面就行</span><br>1) <span class="hljs-string">&quot;dir&quot;</span><br>2) <span class="hljs-string">&quot;/usr/local/bin&quot;</span> <br></code></pre></td></tr></table></figure>
<h4 id="1-3-优缺点">1.3 优缺点</h4>
<p class="label label-success">优点</p>
<ol>
<li>
<p>适合大规模的数据恢复</p>
</li>
<li>
<p>对数据的完整性要不高</p>
</li>
</ol>
<p class="label label-danger">缺点</p>
<ol>
<li>
<p>需要一定的时间间隔进程操作，如果redis意外宕机，最后一次的数据就无了</p>
</li>
<li>
<p>fork进程的时候，会占用一定的内容空间</p>
</li>
</ol>
<h3 id="2、AOF">2、AOF</h3>
<p>AOF全称appendonly file，只追加保存，默认是不保存的，需要手动配置然后 重启redis就行了</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">appendonly no <span class="hljs-comment"># 把这里改成yes就行</span><br></code></pre></td></tr></table></figure>
<h4 id="2-1-AOF文件受损恢复">2.1 AOF文件受损恢复</h4>
<p>redis提供了一个修复aof的工具 “redis-check-aof --fix”</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">redis-check-aof --fix appendonly.aof     <span class="hljs-comment"># 输入这个指令进行AOf修复</span><br></code></pre></td></tr></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/52HZMercury/img/blog/20220415223451.png" srcset="/img/newloading.gif" lazyload alt="修复截图"></p>
<p>修复之后可能会损失一些数据,但总比全部丢了好</p>
<h4 id="2-2-AOF的rewrite">2.2 AOF的rewrite</h4>
<p>aof默认就是文件无限制的追加，因此如果一个文件太大之后，AOF会fork一个新的进程进行重写</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">auto-aof-rewrite-percentage 100<br>auto-aof-rewrite-min-size 64mb<br></code></pre></td></tr></table></figure>
<h4 id="2-2-优点以及缺点">2.2 优点以及缺点</h4>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">appendoly no   <span class="hljs-comment"># 默认不开启</span><br>appendfilename <span class="hljs-string">&quot;appendoly.aof&quot;</span> <span class="hljs-comment">#aof文件的名字 </span><br><br>appendfsync always   <span class="hljs-comment"># 每次修改都执行同步操作，消耗性能</span><br>appendfsync everysec <span class="hljs-comment"># 每秒执行一次，可能会丢失那一秒的数据</span><br>appendfsync no       <span class="hljs-comment"># 不执行同步，操作系统进行同步，速度最快</span><br></code></pre></td></tr></table></figure>
<p class="label label-success">优点</p>
<ol>
<li>每一次修改都同步，文件完整性会更加的好</li>
<li>每秒同步一次，可能会丢失一秒的数据</li>
<li>从来不同步，速度最快</li>
</ol>
<p class="label label-danger">缺点</p>
<ol>
<li>
<p>相对于数据文件来说，aof远远大于rdb，修复的速度也比rdb慢</p>
</li>
<li>
<p>AOF运行效率也要比rdb慢，所以redis默认的配置就是rdb持久化</p>
</li>
</ol>
<h3 id="3、总结以及拓展">3、总结以及拓展</h3>
<ol>
<li>RDB持久化方式能够再指定的时间间隔内对你的数据进行快照存储</li>
<li>AOF持久化方式记录每次对服务器写的操作，当服务器重启的时候会重新执行这些命令来会恢复原始的数据，AOF命令以Redis协议追加保存每次写的操作到文件末尾，Redis还能对AOF文件进行后台重写，使得AOF文件的额体积不至于太大</li>
<li>只做缓存，如果你只希望你的数据再服务器运行的时候存在，你也可以不使用持久化</li>
<li>同时开启两种持久化模式
<ul>
<li>在这种情况下，当redis重启的时候会优先载入AOF文件来恢复原始的数据，因为在通常的情况下AOF文件保存的数据集要比RDB文件保存的数据集更加的完整</li>
<li>RDB的数据不实时，同时使用两种服务器重启也只会找AOF文件，那要不要只使用AOF呢🙌？答案是建议不要，因为RDB更加的适合用于备份数据库(AOF在不断变化不好备份)，快速重启，而且不会有AOF可能潜在的BUG，作为一个留着以防万一的手段</li>
</ul>
</li>
<li>性能建议
<ul>
<li>因为RDB文件只用作后备用途，建议旨在Slave（附机）持久化RDB文件，而且只要15分钟备份一次就行了，只需要保留save 900 1  这条规则</li>
<li>如果Enable AOF，好处是在最恶劣情况下也只会失去不超过两秒的数据，启动脚本只load自己的文件就可以了，代价一是带来了持续的IO，二是AOF rewrite 的最后将 rewrite 过程中产生的新数据写到新文件造成的阻塞时不可避免的，只要硬盘许可，应该尽量减少AOF rewrite的频率，AOF重写的基础大小默认值太小了，可以设置到5G以上，默认超过原大小100%大小重写可以改到适当的数值</li>
<li>如果不Enable AOF，仅靠 Master-Slave实现高可用性也可以，能够省掉一大笔的IO，也减少了rewrite时带来的系统波动，代价时如果Master/Slave同时倒掉，会丢失十几分钟的数据，启动脚本也要比较两个Master/Slave中的RDB文件，载入较新的那个，微博就是这种架构</li>
</ul>
</li>
</ol>
<h2 id="十一、发布订阅">十一、发布订阅</h2>
<p>redis中提供了类似消息队列的功能–发布订阅，但是更加专业的功能仍然需要消息队列来做，比如Kafaka等</p>
<h3 id="1-简单的来实现一下">1. 简单的来实现一下</h3>
<p>订阅一个频道</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash">127.0.0.1:6379&gt; SUBSCRIBE chenning<br><br>Reading messages... (press Ctrl-C to quit)<br><br>1) <span class="hljs-string">&quot;subscribe&quot;</span><br><br>2) <span class="hljs-string">&quot;chenning&quot;</span><br><br>3) (<span class="hljs-built_in">integer</span>) 1<br></code></pre></td></tr></table></figure>
<p>发送端</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">127.0.0.1:6379&gt; PUBLISH chenning <span class="hljs-string">&quot;hell chenning&quot;</span>  <span class="hljs-comment"># 发送一则消息</span><br><br>(<span class="hljs-built_in">integer</span>) 1<br><br>127.0.0.1:6379&gt; <br></code></pre></td></tr></table></figure>
<p>再次回到刚刚订阅的那个窗口，可以看到以下信息</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">1) <span class="hljs-string">&quot;message&quot;</span><br><br>2) <span class="hljs-string">&quot;chenning&quot;</span><br><br>3) <span class="hljs-string">&quot;hell chenning&quot;</span><br></code></pre></td></tr></table></figure>
<p>上述就是一个简单的发布订阅</p>
<h3 id="2-原理">2. 原理</h3>
<p>Redis 是使用c实现的，通过分析 Redis 源码里的 pubsub.c 文件，了解发布和订阅机制的底层实现，籍此加加深对 Redis 的理解。Redis 通过 PUBLISH 、 SUBSCRIBE 和 PSUBSCRIBE 等命令实现发布和订阅功能。</p>
<p>通过 SUBSCRIBE 命令订阅某频道后， redis - server 里维护了一个字典，字典的键就是一个个 channel 而字典的值则是一个链表，链表中保存了所有订阅这个 channel 的客户端。 SUBSCRIBE 命令的关键，就是将客户端添加到给定 channel 的订阅链表中。</p>
<p>通过PUBLSH 命令向订订阅者发送消息， redis-server 会使用给定的频道作为键，在它所维护的 channel 字典中查找记录了订阅这个频道的所有客户的链表，遍历这个链表，将消息发布给所有订阅者。</p>
<p>Pub / Sub 从字面上理解就是发布（ Publish ）与订阅（ Subscribe )，在 Redis 中，你可以设定对某一个 key 值进行消息发布及消息订阅，当一个 key 值上进行了消息发布后，所有订阅它的客户端都会收到相应的消息。这一功能最明显的用法就是用作实时消息系统，比如普通的即时聊天，群聊等功能。</p>
<h2 id="十二、主从复制">十二、主从复制</h2>
<h3 id="1-概念">1. 概念</h3>
<p>主从复制，是指将一台 Redis 服务器的数据，复制到其他的 Redis 服务器。前者称为主节点（ master / leader )，后者称为从节点( slave / folower )；数据的复制是单向的，只能由主节点到从节点。 Master 以写为主， Slave 以读为主。</p>
<p>默认情况下，每台 Redis 服务器都是王节点；且一个王节点可以有多个从节点（或没有从节点），但一个从节点只能有一个主节点。</p>
<p><span class = "label label-success">主从复制的作用主要包括：</span></p>
<p>1、数据冗余：主从复制实现了数据的热备份，是持久化之外的一种数据冗余方式。2、故障恢复：当主节点出现问题时，可以由从节点提供服务，实现快速的故障恢复；实际上是一种服务的冗余。<br>
3、负载均衡：在主从复制的基础上，配合读写分离，可以由主节点提供写服务，由从节点提供读服务（即写 Redis 数据时应用连接主节点，读 Redis 数据时应用连接从节点），分担服务器负载；尤其是在写少读多的场景下，通过多个从节点分担读负载，可以大大提高 Redis 服务器的并发量。<br>
4、高可用基石：除了上述作用以外，主从复制还是哨兵和集群能够实施的基础，因此说主从复制是 Redis 高可用的基础。</p>
<p>一般来说，要将 Redis 运用于工程项目中，只使用一台 Redis 是万万不能的，原因如下：</p>
<p>1、从结构上，单个 Redis 服务器会发生单点故障，并且一台服务器需要处理所有的请求负载，压力较大；<br>
2、从容量上，单个 Redis 服务器内存容量有限，就算一台 Redis 服务器内存容量为256G，也不能将所有内存用作 Redis 存储内存，<br>
一般来说，单台 Redis 最大使用内存不应该超过20G。</p>
<h3 id="2-环境配置">2. 环境配置</h3>
<p>只配置从库 不配置主库,因为默认自己为主库</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs bash">127.0.0.1:6379&gt; info replication<br><br><span class="hljs-comment"># Replication</span><br><br>role:master                                     <span class="hljs-comment"># 可以看到这里默认自己是主机</span><br><br>connected_slaves:0<br><br>master_failover_state:no-failover<br><br>master_replid:4fbf9a6eb1fa637393710a004aa2839976897b2c<br><br>master_replid2:0000000000000000000000000000000000000000<br><br>master_repl_offset:0<br><br>second_repl_offset:-1<br><br>repl_backlog_active:0<br><br>repl_backlog_size:1048576<br><br>repl_backlog_first_byte_offset:0<br><br>repl_backlog_histlen:0<br></code></pre></td></tr></table></figure>
<p>接下来我们使用三个端口启动三个redis服务</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@Mercury Nconfig]<span class="hljs-comment"># cp redis.conf redis79.conf </span><br><br>[root@Mercury Nconfig]<span class="hljs-comment"># cp redis.conf redis80.conf </span><br><br>[root@Mercury Nconfig]<span class="hljs-comment"># cp redis.conf redis81.conf    # 复制了三份配置文件</span><br><br>[root@Mercury Nconfig]<span class="hljs-comment"># ll</span><br><br>total 368<br><br>-rw-r--r-- 1 root root 93725 Apr 15 18:56 redis79.conf<br><br>-rw-r--r-- 1 root root 93725 Apr 15 18:56 redis80.conf<br><br>-rw-r--r-- 1 root root 93725 Apr 15 18:56 redis81.conf<br><br>-rw-r--r-- 1 root root 93725 Apr 14 17:22 redis.conf<br><br><span class="hljs-comment"># 为保证不重名，配置文件里需要修改 端口 pid名字 log文件名字 dump.rdb名字</span><br><br>[root@Mercury bin]<span class="hljs-comment"># redis-server Nconfig/redis79.conf</span><br>[root@Mercury bin]<span class="hljs-comment"># redis-server Nconfig/redis80.conf</span><br>[root@Mercury bin]<span class="hljs-comment"># redis-server Nconfig/redis81.conf     #分别指定配置文件进行启动</span><br><br><br>[root@Mercury bin]<span class="hljs-comment"># ps -ef|grep redis</span><br><br>root  6093  1 0 19:05 ?  00:00:00 redis-server 127.0.0.1:6380<br><br>root  6108  1 0 19:05 ?  00:00:00 redis-server 127.0.0.1:6381<br><br>root  6277 19173 0 19:06 pts/1 00:00:00 grep --color=auto redis<br><br>root  27191  1 0 Apr14 ?  00:02:28 redis-server 127.0.0.1:6379    <span class="hljs-comment"># 可以看到已经分别启动了</span><br></code></pre></td></tr></table></figure>
<h3 id="3-一主二从">3. 一主二从</h3>
<p>所谓一主二从就是一台主机两台从机</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><code class="hljs bash">127.0.0.1:6380&gt; SLAVEOF 127.0.0.1 6379          <span class="hljs-comment"># 通过这个命令将6380设为6379的从机</span><br><br>OK<br><br>127.0.0.1:6380&gt; info replication<br><br><span class="hljs-comment"># Replication</span><br><br>role:slave                                      <span class="hljs-comment"># 可以看到已经变为从机</span><br><br>master_host:127.0.0.1<br><br>master_port:6379<br><br>master_link_status:up<br><br>master_last_io_seconds_ago:5<br><br>master_sync_in_progress:0<br><br>slave_read_repl_offset:14<br><br>slave_repl_offset:14<br><br>slave_priority:100<br><br>slave_read_only:1<br><br>replica_announced:1<br><br>connected_slaves:0<br><br>master_failover_state:no-failover<br><br>master_replid:1f474dfc54aedd694b971cefafd50927b55f97a4<br><br>master_replid2:0000000000000000000000000000000000000000<br><br>master_repl_offset:14<br><br>second_repl_offset:-1<br><br>repl_backlog_active:1<br><br>repl_backlog_size:1048576<br><br>repl_backlog_first_byte_offset:1<br><br>repl_backlog_histlen:14<br></code></pre></td></tr></table></figure>
<p>再次查看6379</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@Mercury bin]<span class="hljs-comment"># redis-cli -p 6379</span><br><br>127.0.0.1:6379&gt; info replication<br><br><span class="hljs-comment"># Replication</span><br><br>role:master<br><br>connected_slaves:1                            <span class="hljs-comment"># 显示已连接从机数量</span><br><br>slave0:ip=127.0.0.1,port=6380,state=online,offset=84,lag=1  <span class="hljs-comment"># 显示从机状态     </span><br><br>master_failover_state:no-failover<br><br>master_replid:1f474dfc54aedd694b971cefafd50927b55f97a4<br><br>master_replid2:0000000000000000000000000000000000000000<br><br>master_repl_offset:84<br><br>second_repl_offset:-1<br><br>repl_backlog_active:1<br><br>repl_backlog_size:1048576<br><br>repl_backlog_first_byte_offset:1<br><br>repl_backlog_histlen:84<br></code></pre></td></tr></table></figure>
<p>以同样的步骤连接上6381</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs bash">127.0.0.1:6379&gt; info replication<br><br><span class="hljs-comment"># Replication</span><br><br>role:master<br><br>connected_slaves:2                <span class="hljs-comment"># 两个从机</span><br><br>slave0:ip=127.0.0.1,port=6380,state=online,offset=280,lag=0<br><br>slave1:ip=127.0.0.1,port=6381,state=online,offset=280,lag=1<br><br>master_failover_state:no-failover<br><br>master_replid:1f474dfc54aedd694b971cefafd50927b55f97a4<br><br>master_replid2:0000000000000000000000000000000000000000<br><br>master_repl_offset:280<br><br>second_repl_offset:-1<br><br>repl_backlog_active:1<br><br>repl_backlog_size:1048576<br><br>repl_backlog_first_byte_offset:1<br><br>repl_backlog_histlen:280<br><br><br></code></pre></td></tr></table></figure>
<p>因为这里我们是通过指令操作的，所以关闭服务后就不再是从机了，而是会变回主机，如果想一直是从机，我们可以在配置文件里面修改</p>
<p><span lable label-success>配置文件里面</span></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">replicaof   &lt;masterip&gt;   &lt;masterport&gt;<br></code></pre></td></tr></table></figure>
<h4 id="3-1-细节了解">3.1 细节了解</h4>
<p>主机可以设置值，从机不能写只能读</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs bash">127.0.0.1:6379&gt; <span class="hljs-built_in">set</span> k1 <span class="hljs-string">&quot;v1&quot;</span><br><br>OK<br><br>127.0.0.1:6379&gt; get k1<br><br><span class="hljs-string">&quot;v1&quot;</span><br><br><span class="hljs-comment"># 主机设置 key-value</span><br><br><br><br>127.0.0.1:6380&gt; get k1<br><br><span class="hljs-string">&quot;v1&quot;</span><br><br><span class="hljs-comment"># 从机可以拿到</span><br><br><br>127.0.0.1:6380&gt; <span class="hljs-built_in">set</span> k2 <span class="hljs-string">&quot;v2&quot;</span><br><br>(error) READONLY You can<span class="hljs-string">&#x27;t write against a read only replica.</span><br><span class="hljs-string"></span><br><span class="hljs-string"># 从机不可以写</span><br></code></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 主机断开</span><br><br>127.0.0.1:6379&gt; SHUTDOWN  <br><br>not connected&gt;<br><br><br><br>127.0.0.1:6380&gt; info replication<br><br><span class="hljs-comment"># Replication</span><br><br>role:slave                 <span class="hljs-comment"># 依然是从机</span><br><br>master_host:127.0.0.1<br><br>master_port:6379<br><br>master_link_status:down<br><br>master_last_io_seconds_ago:-1<br><br>master_sync_in_progress:0<br><br>slave_read_repl_offset:962<br><br>slave_repl_offset:962<br><br>master_link_down_since_seconds:33<br><br>slave_priority:100<br><br>slave_read_only:1<br><br>replica_announced:1<br><br>connected_slaves:0<br><br>master_failover_state:no-failover<br><br>master_replid:1f474dfc54aedd694b971cefafd50927b55f97a4<br><br>master_replid2:0000000000000000000000000000000000000000<br><br>master_repl_offset:962<br><br>second_repl_offset:-1<br><br>repl_backlog_active:1<br><br>repl_backlog_size:1048576<br><br>repl_backlog_first_byte_offset:1<br><br>repl_backlog_histlen:962<br></code></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 主机重新启动</span><br><br>[root@Mercury bin]<span class="hljs-comment"># redis-server Nconfig/redis79.conf </span><br><br>[root@Mercury bin]<span class="hljs-comment"># redis-cli -p 6379</span><br><br>127.0.0.1:6379&gt; <span class="hljs-built_in">set</span> k2 <span class="hljs-string">&quot;v2&quot;</span><br><br>OK<br><br><span class="hljs-comment">#再次设置值</span><br><br>127.0.0.1:6380&gt; get k2<br><br><span class="hljs-string">&quot;v2&quot;</span><br><br><span class="hljs-comment"># 依然可以拿到</span><br></code></pre></td></tr></table></figure>
<p>主机断开连接，从机依然连接到主机的，但是没有写操作，这个时候，主机如果回来了，从机依旧可以直接获取到主机写的信息，但如果是使用命令行来配置的从机，重启后就会变回主机，不再和原来的主机同步，无法获取之后写入的信息，但只要再变回从机，立刻就可以从主机中获取值。</p>
<h3 id="4-复制原理">4. 复制原理</h3>
<p>Slave 启动成功连接到 master 后会发送一个 sync 命令</p>
<p>Master 接到命令，启动后台的存盘进程，同时收集所有接收到的用于修改数据集命令，在后台进程执行完毕之后， master 将传送整个数据文件到 slave ，并完成一次完全同步。</p>
<p>全量复制：而 slave 服务在接收到数据库文件数据后，将其存盘并加载到内存中。<br>
增量复制： Master 继续将新的所有收集到的修改命令依次传给 slave ，完成同步但是只要是重新连接 master ，一次完全同步（全量复制）将被自动执行🚗</p>
<h3 id="5-层层链路">5. 层层链路</h3>
<p>使用下面的方式将三个 redis 服务连接起来</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">79</span>-----------<span class="hljs-number">80</span>---------<span class="hljs-number">81</span> <br><br> <span class="hljs-attribute">M</span>          M  S        S<br></code></pre></td></tr></table></figure>
<p>此时的80端口依旧是从节点，输入命令可以看到依然显示为Salve</p>
<p>一般层层链路不常用</p>
<h3 id="6-谋朝篡位-🤪">6. 谋朝篡位 🤪</h3>
<p>如果主机断开了连接，我们可以使用<span class = "label label-danger">SLAVEOF no one</span>命令使自己变成主机，其他主机可以手动连接到这个主节点</p>
<h2 id="十三、哨兵模式">十三、哨兵模式</h2>
<h3 id="1-概念-2">1. 概念</h3>
<p>简单的来说，哨兵模式就是自动选举主机的模式。一般情况下，当主服务器宕机后，需要手动把一台服务器切换为主服务器，但是手动对于程序员来讲还是太麻烦了🙌,所以Redis从2.8正式提供了Sentinel哨兵模式来解决这个问题</p>
<p>哨兵模式能够在后台自动监测主机是否故障，如果故障了将根据投票数自动将从机转换为主机，哨兵模式是一种特殊的模式，首先Redis提供了哨兵的命令，哨兵是一个独立的进程。原理就是哨兵通过发送命令，等待服务器响应，从而监控多个redis实例</p>
<p><img src="https://cdn.jsdelivr.net/gh/52HZMercury/img/blog/image-20220417190613545.png" srcset="/img/newloading.gif" lazyload alt="哨兵示意图"></p>
<p>过程：假设主服务器宕机(比如断电啥的)，哨兵会检测到这个结果，系统并不会马上进行failover过程，仅仅是哨兵1主观的认为主服务器不可用，这个现象称为<strong>主观下线</strong>。当后面的哨兵也检测到主服务器不可用，并且数量达到一定值时，那么哨兵之间就会进行一次投票，投票的结果由一个哨兵发起，进行failover[故障转移]操作。切换成功后，就会通过发布订阅模式，让各个哨兵把自己监控的从服务器实现切换主机，这个过程称为<strong>客观下线</strong></p>
<h3 id="2-实际测试一波">2. 实际测试一波</h3>
<p>简单编辑配置文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@Mercury Nconfig]<span class="hljs-comment"># vim sentinel.conf</span><br><br>sentinel monitor myredis 127.0.0.1 6379 1<br><br><span class="hljs-comment"># 后面这个数字1代表有多少个哨兵认为这个主机挂了就执行换主机的操作</span><br><br></code></pre></td></tr></table></figure>
<p>启动哨兵服务</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 启动命令</span><br>[root@Mercury bin]<span class="hljs-comment"># redis-sentinel Nconfig/sentinel.conf</span><br>32048:X 17 Apr 2022 18:15:13.108 <span class="hljs-comment"># oO0OoO0OoO0Oo Redis is starting oO0OoO0OoO0Oo</span><br>32048:X 17 Apr 2022 18:15:13.108 <span class="hljs-comment"># Redis version=6.2.6, bits=64, commit=00000000, modified=0, pid=32048, just started</span><br>32048:X 17 Apr 2022 18:15:13.108 <span class="hljs-comment"># Configuration loaded</span><br>32048:X 17 Apr 2022 18:15:13.109 * monotonic clock: POSIX clock_gettime<br>                _._                                                  <br>           _.-``__ <span class="hljs-string">&#x27;&#x27;</span>-._                                             <br>      _.-``    `.  `_.  <span class="hljs-string">&#x27;&#x27;</span>-._           Redis 6.2.6 (00000000/0) 64 bit<br>  .-`` .-```.  ```\/    _.,_ <span class="hljs-string">&#x27;&#x27;</span>-._                                  <br> (    <span class="hljs-string">&#x27;      ,       .-`  | `,    )     Running in sentinel mode</span><br><span class="hljs-string"> |`-._`-...-` __...-.``-._|&#x27;</span>` _.-<span class="hljs-string">&#x27;|     Port: 26379</span><br><span class="hljs-string"> |    `-._   `._    /     _.-&#x27;</span>    |     PID: 32048<br>  `-._    `-._  `-./  _.-<span class="hljs-string">&#x27;    _.-&#x27;</span>                                   <br> |`-._`-._    `-.__.-<span class="hljs-string">&#x27;    _.-&#x27;</span>_.-<span class="hljs-string">&#x27;|                                  </span><br><span class="hljs-string"> |    `-._`-._        _.-&#x27;</span>_.-<span class="hljs-string">&#x27;    |           https://redis.io       </span><br><span class="hljs-string">  `-._    `-._`-.__.-&#x27;</span>_.-<span class="hljs-string">&#x27;    _.-&#x27;</span>                                   <br> |`-._`-._    `-.__.-<span class="hljs-string">&#x27;    _.-&#x27;</span>_.-<span class="hljs-string">&#x27;|                                  </span><br><span class="hljs-string"> |    `-._`-._        _.-&#x27;</span>_.-<span class="hljs-string">&#x27;    |                                  </span><br><span class="hljs-string">  `-._    `-._`-.__.-&#x27;</span>_.-<span class="hljs-string">&#x27;    _.-&#x27;</span>                                   <br>      `-._    `-.__.-<span class="hljs-string">&#x27;    _.-&#x27;</span>                                       <br>          `-._        _.-<span class="hljs-string">&#x27;                                           </span><br><span class="hljs-string">              `-.__.-&#x27;</span>                                               <br><br>32048:X 17 Apr 2022 18:15:13.110 <span class="hljs-comment"># WARNING: The TCP backlog setting of 511 cannot be enforced because /proc/sys/net/core/somaxconn is set to the lower value of 128.</span><br>32048:X 17 Apr 2022 18:15:13.114 <span class="hljs-comment"># Sentinel ID is b7a639b54bcccf0219a5c5390726703b88a2d628</span><br>32048:X 17 Apr 2022 18:15:13.114 <span class="hljs-comment"># +monitor master myredis 127.0.0.1 6379 quorum 1</span><br>32048:X 17 Apr 2022 18:15:13.115 * +slave slave 127.0.0.1:6380 127.0.0.1 6380 @ myredis 127.0.0.1 6379<br></code></pre></td></tr></table></figure>
<p>然后我们关闭6379这个主机</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">127.0.0.1:6379&gt; SHUTDOWN<br>not connected&gt;<br></code></pre></td></tr></table></figure>
<p>等待一段时间后可以看到</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs bash">32048:X 17 Apr 2022 18:21:49.348 <span class="hljs-comment"># +sdown master myredis 127.0.0.1 6379</span><br><br>32048:X 17 Apr 2022 18:21:49.348 <span class="hljs-comment"># +odown master myredis 127.0.0.1 6379 #quorum 1/1         #满足了条件</span><br><br>32048:X 17 Apr 2022 18:21:49.348 <span class="hljs-comment"># +new-epoch 1</span><br><br>32048:X 17 Apr 2022 18:21:49.348 <span class="hljs-comment"># +try-failover master myredis 127.0.0.1 6379</span><br><br>32048:X 17 Apr 2022 18:21:49.351 <span class="hljs-comment"># +vote-for-leader b7a639b54bcccf0219a5c5390726703b88a2d628 1</span><br><br>32048:X 17 Apr 2022 18:21:49.351 <span class="hljs-comment"># +elected-leader master myredis 127.0.0.1 6379</span><br><br>32048:X 17 Apr 2022 18:21:49.351 <span class="hljs-comment"># +failover-state-select-slave master myredis 127.0.0.1 6379</span><br><br>32048:X 17 Apr 2022 18:21:49.442 <span class="hljs-comment"># +selected-slave slave 127.0.0.1:6380 127.0.0.1 6380 @ myredis 127.0.0.1 6379</span><br><br>32048:X 17 Apr 2022 18:21:49.442 * +failover-state-send-slaveof-noone slave 127.0.0.1:6380 127.0.0.1 6380 @ myredis 127.0.0.1 6379<br><br>32048:X 17 Apr 2022 18:21:49.508 * +failover-state-wait-promotion slave 127.0.0.1:6380 127.0.0.1 6380 @ myredis 127.0.0.1 6379<br><br>32048:X 17 Apr 2022 18:21:49.716 <span class="hljs-comment"># +promoted-slave slave 127.0.0.1:6380 127.0.0.1 6380 @ myredis 127.0.0.1 6379</span><br><br>32048:X 17 Apr 2022 18:21:49.716 <span class="hljs-comment"># +failover-state-reconf-slaves master myredis 127.0.0.1 6379</span><br><br>32048:X 17 Apr 2022 18:21:49.789 <span class="hljs-comment"># +failover-end master myredis 127.0.0.1 6379</span><br><br>32048:X 17 Apr 2022 18:21:49.789 <span class="hljs-comment"># +switch-master myredis 127.0.0.1 6379 127.0.0.1 6380          # 6380成为了主机</span><br><br>32048:X 17 Apr 2022 18:21:49.790 * +slave slave 127.0.0.1:6379 127.0.0.1 6379 @ myredis 127.0.0.1 6380<br><br>32048:X 17 Apr 2022 18:21:50.420 * +slave slave 127.0.0.1:6381 127.0.0.1 6381 @ myredis 127.0.0.1 6380<br><br>32048:X 17 Apr 2022 18:22:19.834 <span class="hljs-comment"># +sdown slave 127.0.0.1:6379 127.0.0.1 6379 @ myredis 127.0.0.1 6380</span><br></code></pre></td></tr></table></figure>
<p>我们再来看看6380的信息</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs bash">127.0.0.1:6380&gt; info replication<br><br><span class="hljs-comment"># Replication</span><br><br>role:master                            <span class="hljs-comment"># 很明显这里已经成为了主机</span><br><br>connected_slaves:1<br><br>slave0:ip=127.0.0.1,port=6381,state=online,offset=265004,lag=1<br><br>master_failover_state:no-failover<br><br>master_replid:4e0b279d0bae3d59691444c3d8a264de3859340b<br><br>master_replid2:9ea51c7e5cefa6a5b8e281bb4fa433fb34f9292d<br><br>master_repl_offset:265136<br><br>second_repl_offset:258784<br><br>repl_backlog_active:1<br><br>repl_backlog_size:1048576<br><br>repl_backlog_first_byte_offset:1<br><br>repl_backlog_histlen:265136<br></code></pre></td></tr></table></figure>
<p>以上就是哨兵模式的实际测试，如果主机此时回来了，只能归到新的主机下</p>
<h3 id="3-优缺点">3. 优缺点</h3>
<p><span class = "label label-success">优点</span></p>
<ol>
<li>哨兵集群，基于主从复制模式，所有的主从配置的优点，它全都有</li>
<li>主从是可以切换的，故障可以转移，系统的可用性会更好</li>
<li>哨兵模式就是主从模式的升级，手动到自动</li>
</ol>
<p><span class = "label label-danger">缺点</span></p>
<ol>
<li>Redis不好在线扩容，集群的数量一旦达到上限，在线扩容就十分的麻烦</li>
<li>实现哨兵模式的配置比较麻烦，里面有很多选择</li>
</ol>
<h3 id="哨兵模式的全部配置">哨兵模式的全部配置</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># Example sentinel.conf</span><br><br><span class="hljs-comment"># 哨兵sentinel实例运行的端口 默认26379</span><br><br>port 26379<br><br><br><br><span class="hljs-comment"># 哨兵sentinel的工作目录</span><br><br>dir /tmp<br><br><br><br><span class="hljs-comment"># 哨兵sentinel监控的redis主节点的 ip port</span><br><br><span class="hljs-comment"># master-name 可以自己命名的主节点名字 只能由字母A-z、数字0-9 、这三个字符&quot;.-_&quot;组成。</span><br><br><span class="hljs-comment"># quorum 配置多少个sentinel哨兵统一认为master主节点失联 那么这时客观上认为主节点失联了</span><br><br><span class="hljs-comment"># sentinel monitor &lt;master-name&gt; &lt;ip&gt; &lt;redis-port&gt; &lt;quorum&gt;</span><br><br>sentinel monitor mymaster 127.0.0.1 6379 2<br><br><br><br><span class="hljs-comment"># 当在Redis实例中开启了requirepass foobared 授权密码 这样所有连接Redis实例的客户端都要提供密码</span><br><br><span class="hljs-comment"># 设置哨兵sentinel 连接主从的密码 注意必须为主从设置一样的验证密码</span><br><br><span class="hljs-comment"># sentinel auth-pass &lt;master-name&gt; &lt;password&gt;</span><br><br>sentinel auth-pass mymaster MySUPER--secret-0123passw0rd<br><br><br><br><span class="hljs-comment"># 指定多少毫秒之后 主节点没有应答哨兵sentinel 此时 哨兵主观上认为主节点下线 默认30秒</span><br><br><span class="hljs-comment"># sentinel down-after-milliseconds &lt;master-name&gt; &lt;milliseconds&gt;</span><br><br>sentinel down-after-milliseconds mymaster 30000<br><br><br><br><span class="hljs-comment"># 这个配置项指定了在发生failover主备切换时最多可以有多少个slave同时对新的master进行 同步，这个数字越小，完成failover所需的时间就越长，但是如果这个数字越大，就意味着越 多的slave因为replication而不可用。可以通过将这个值设为 1 来保证每次只有一个slave 处于不能处理命令请求的状态。</span><br><br><span class="hljs-comment"># sentinel parallel-syncs &lt;master-name&gt; &lt;numslaves&gt;</span><br><br>sentinel parallel-syncs mymaster 1<br><br><br><br><span class="hljs-comment"># 故障转移的超时时间 failover-timeout 可以用在以下这些方面：</span><br><br><span class="hljs-comment">#1. 同一个sentinel对同一个master两次failover之间的间隔时间。</span><br><br><span class="hljs-comment">#2. 当一个slave从一个错误的master那里同步数据开始计算时间。直到slave被纠正为向正确的master那里同步数据时。</span><br><br><span class="hljs-comment">#3.当想要取消一个正在进行的failover所需要的时间。 </span><br><br><span class="hljs-comment">#4.当进行failover时，配置所有slaves指向新的master所需的最大时间。不过，即使过了这个超时，slaves依然会被正确配置为指向master，但是就不按parallel-syncs所配置的规则来了</span><br><br><span class="hljs-comment"># 默认三分钟</span><br><br><span class="hljs-comment"># sentinel failover-timeout &lt;master-name&gt; &lt;milliseconds&gt;</span><br><br>sentinel failover-timeout mymaster 180000<br><br><br><br><span class="hljs-comment"># SCRIPTS EXECUTION</span><br><br><span class="hljs-comment">#配置当某一事件发生时所需要执行的脚本，可以通过脚本来通知管理员，例如当系统运行不正常时发邮件通知相关人员。</span><br><br><span class="hljs-comment">#对于脚本的运行结果有以下规则：</span><br><br><span class="hljs-comment">#若脚本执行后返回1，那么该脚本稍后将会被再次执行，重复次数目前默认为10</span><br><br><span class="hljs-comment">#若脚本执行后返回2，或者比2更高的一个返回值，脚本将不会重复执行。</span><br><br><span class="hljs-comment">#如果脚本在执行过程中由于收到系统中断信号被终止了，则同返回值为1时的行为相同。</span><br><br><span class="hljs-comment">#一个脚本的最大执行时间为60s，如果超过这个时间，脚本将会被一个SIGKILL信号终止，之后重新执行。</span><br><br><span class="hljs-comment">#通知型脚本:当sentinel有任何警告级别的事件发生时（比如说redis实例的主观失效和客观失效等等），将会去调用这个脚本，这时这个脚本应该通过邮件，SMS等方式去通知系统管理员关于系统不正常运行的信息。调用该脚本时，将传给脚本两个参数，一个是事件的类型，一个是事件的描述。如果sentinel.conf配置文件中配置了这个脚本路径，那么必须保证这个脚本存在于这个路径，并且是可执行的，否则sentinel无法正常启动成功。</span><br><br><br><br><span class="hljs-comment">#通知脚本</span><br><br><span class="hljs-comment"># shell编程</span><br><br><span class="hljs-comment"># sentinel notification-script &lt;master-name&gt; &lt;script-path&gt;</span><br><br>sentinel notification-script mymaster /var/redis/notify.sh<br><br><br><br><span class="hljs-comment"># 客户端重新配置主节点参数脚本</span><br><br><span class="hljs-comment"># 当一个master由于failover而发生改变时，这个脚本将会被调用，通知相关的客户端关于master地址已经发生改变的信息。</span><br><br><span class="hljs-comment"># 以下参数将会在调用脚本时传给脚本:</span><br><br><span class="hljs-comment"># &lt;master-name&gt; &lt;role&gt; &lt;state&gt; &lt;from-ip&gt; &lt;from-port&gt; &lt;to-ip&gt; &lt;to-port&gt;</span><br><br><span class="hljs-comment"># 目前&lt;state&gt;总是“failover”,</span><br><br><span class="hljs-comment"># &lt;role&gt;是“leader”或者“observer”中的一个。</span><br><br><span class="hljs-comment"># 参数 from-ip, from-port, to-ip, to-port是用来和旧的master和新的master(即旧的slave)通信的</span><br><br><span class="hljs-comment"># 这个脚本应该是通用的，能被多次调用，不是针对性的。</span><br><br><span class="hljs-comment"># sentinel client-reconfig-script &lt;master-name&gt; &lt;script-path&gt;</span><br><br>sentinel client-reconfig-script mymaster /var/redis/reconfig.sh <span class="hljs-comment"># 一般都是由运维来配置！</span><br><br><br></code></pre></td></tr></table></figure>
<h2 id="十四、缓存穿透和雪崩">十四、缓存穿透和雪崩</h2>
<h3 id="1-缓存穿透">1. 缓存穿透</h3>
<h4 id="1-1-概念">1.1 概念</h4>
<p>缓存穿透的概念很简单，用户想要查询一个数据，发现 redis 内存数据库没有，也就是缓存没有命中，于是向持久层数据库查询。现也没有，于是本次查询失败。当用户很多的时候，缓存都没有命中（秒杀！)，于是都去请求了持久层数据库。这会给持久层数据库造成很大的压力，这时候就相当于出现了缓存穿透。</p>
<h4 id="1-2-解决方案">1.2 解决方案</h4>
<h5 id="布隆过滤器">布隆过滤器</h5>
<p>布隆过滤器是一种数据结构，对所有可能査询的参数以 hash 形式存储，在控制层先进行校验，不符合则丢弃，从而避免了对底层存储系统的查询压力；</p>
<p><img src="https://cdn.jsdelivr.net/gh/52HZMercury/img/blog/image-20220417194623551.png" srcset="/img/newloading.gif" lazyload alt="布隆过滤器"></p>
<h5 id="缓存空对象">缓存空对象</h5>
<p>当存储层不命中后，即使返回的空对象也将其缓存起来，同时设置一个过期时间，之后再访问这个数据会从缓存中获取，保护了后端数据源</p>
<p><img src="https://cdn.jsdelivr.net/gh/52HZMercury/img/blog/image-20220417194749943.png" srcset="/img/newloading.gif" lazyload alt="缓存空对象"></p>
<p>但是这种方法会存在两个问题：<br>
1、如果空值能够被缓存起来，这就意味着缓存需要更多的空间存储更多的键，因为这当中可能会有很多的空值的键；<br>
2、即使对空值设置了过期时间，还是会存在缓存层和存储层的数据会有一段时间窗口的不一致，这对于需要保持一致性的业务会<br>
有影响。</p>
<h3 id="2-缓存击穿">2. 缓存击穿</h3>
<h4 id="2-1-概述">2.1 概述</h4>
<p>这里需要注意和缓存击穿的区别，缓存击穿，是指一个 key 非常热点，在不停的扛着大并发，大并发集中对这一个点进行访问，当这个 key 在失效的瞬间，持续的大并发就穿破缓存，直接请求数据库，就像在一个屏障上凿开了一个洞。当某个 key 在过期的瞬间，有大量的请求并发访问，这类数据一般是热点数据，由于缓存过期，会同时访问数据库来查询最新数据，并且回写缓存，会导使数据库瞬间压力过大。</p>
<h4 id="2-2-解决方案">2.2 解决方案</h4>
<h5 id="设置热点数据永不过期">设置热点数据永不过期</h5>
<p>从缓存层面来看，没有设置过期时间，所以不会出现热点 key 过期后产生的问题。</p>
<h5 id="加互斥锁">加互斥锁</h5>
<p>分布式锁：使用分布式锁，保证对于每个 key 同时只有一个线程去査询后端服务，其他线程没有获得分布式锁的权限，因此只需要等待即可。这种方式将高并发的压力转移到了分布式锁，因此对分布式锁的考验很大。</p>
<h3 id="3-缓存雪崩">3. 缓存雪崩</h3>
<h4 id="3-1-概念">3.1 概念</h4>
<p>缓存雪崩，是指在某一个时间段，缓存集中过期失效。 Redis 宕机！发生雪崩的原因之一，比如在双十一零点，很快就会迎来一波抢购，这波商品时间比较集中的放入了缓存，假设缓存一个小时。那么到了凌晨一点钟的时候，这批商品的缓存就都过期了。而对这批商品的访问查询，都落到了数据库上，对于数据库而言，就会产生周期性的压力波峰。于是所有的请求都会达到存储层，存储层的调用量会暴增，造成存储层也会挂掉的情况。</p>
<p>其实集中过期，倒不是非常致命，比较致命的缓存雪崩，是缓存服务器某个节点宕机或断网。因为自然形成的缓存雪崩，一定是在某个时间段集中创建缓存，这个时候，数据库也是可以顶住压力的。无非就是对数据库产生周期性的压力而已。而缓存服务节点的宕机，对数据库服务器造成的压力是不可预知知的，很有可能瞬间就把数据库压垮。</p>
<h4 id="3-2-解决方案">3.2 解决方案</h4>
<h5 id="redis-高可用">redis 高可用</h5>
<p>这个思想的含义是，既然 redis 有可能挂掉，那我多增设几台 redis ，这样一台挂掉之后其他的还可以继续工作，实就是搭建的集群。（异地多活！)</p>
<h5 id="限流降级">限流降级</h5>
<p>这个解决方案的思想是，在缓存失效后，通过加锁或者队列来控制读数据库写缓存的线程数量。比如对某个 key 只允许一个线程查询数据和写缓存，其他线程等待。</p>
<h5 id="数据预热">数据预热</h5>
<p>数据加热的含义就是在正式部署之前，我先把可能的数据先预先访问一遍，这样部分可能大量访问的数据就会加载到缓存中。在即将发生大并发访问前手动触发加载缓存不同的 key ，设置不同的过期时间，让缓存失效的时间点尽量均匀。</p>

              
            </div>
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/database/" class="category-chain-item">database</a>
  
  

      </span>
    
  
</span>

    </div>
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/database/">#database</a>
      
        <a href="/tags/NoSQL/">#NoSQL</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>Redis</div>
      <div>http://example.com/2022/03/07/Redis/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>Mercury</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2022年3月7日</div>
        </div>
      
      
      <div class="license-meta-item">
        <div>许可协议</div>
        <div>
          
            
            
              <a target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
              <span class="hint--top hint--rounded" aria-label="BY - 署名">
                <i class="iconfont icon-by"></i>
              </span>
              </a>
            
          
        </div>
      </div>
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2022/04/07/perpare/" title="刷题杂谈">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">刷题杂谈</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2022/03/05/Git/" title="Git">
                        <span class="hidden-mobile">Git</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;目录</p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  


  
  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> <div style="font-size: 0.85rem"> <span id="timeDate">载入天数...</span> <span id="times">载入时分秒...</span> <script src="/js/duration.js"></script> </div> 
    </div>
  
  
    <div class="statistics">
  
  

  
    
      <span id="busuanzi_container_site_pv" style="display: none">
        总访问量 
        <span id="busuanzi_value_site_pv"></span>
         次
      </span>
    
    
      <span id="busuanzi_container_site_uv" style="display: none">
        总访客数 
        <span id="busuanzi_value_site_uv"></span>
         人
      </span>
    
    
  
</div>

  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.0/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>






  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.18.0/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      headingSelector : CONFIG.toc.headingSelector || 'h1,h2,h3,h4,h5,h6',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      collapseDepth   : CONFIG.toc.collapseDepth || 0,
      scrollSmooth    : true,
      headingsOffset  : -boardTop
    });
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }
  });
</script>


  <script>
  (function() {
    var enableLang = CONFIG.code_language.enable && CONFIG.code_language.default;
    var enableCopy = CONFIG.copy_btn;
    if (!enableLang && !enableCopy) {
      return;
    }

    function getBgClass(ele) {
      return Fluid.utils.getBackgroundLightness(ele) >= 0 ? 'code-widget-light' : 'code-widget-dark';
    }

    var copyTmpl = '';
    copyTmpl += '<div class="code-widget">';
    copyTmpl += 'LANG';
    copyTmpl += '</div>';
    jQuery('.markdown-body pre').each(function() {
      var $pre = jQuery(this);
      if ($pre.find('code.mermaid').length > 0) {
        return;
      }
      if ($pre.find('span.line').length > 0) {
        return;
      }

      var lang = '';

      if (enableLang) {
        lang = CONFIG.code_language.default;
        if ($pre[0].children.length > 0 && $pre[0].children[0].classList.length >= 2 && $pre.children().hasClass('hljs')) {
          lang = $pre[0].children[0].classList[1];
        } else if ($pre[0].getAttribute('data-language')) {
          lang = $pre[0].getAttribute('data-language');
        } else if ($pre.parent().hasClass('sourceCode') && $pre[0].children.length > 0 && $pre[0].children[0].classList.length >= 2) {
          lang = $pre[0].children[0].classList[1];
          $pre.parent().addClass('code-wrapper');
        } else if ($pre.parent().hasClass('markdown-body') && $pre[0].classList.length === 0) {
          $pre.wrap('<div class="code-wrapper"></div>');
        }
        lang = lang.toUpperCase().replace('NONE', CONFIG.code_language.default);
      }
      $pre.append(copyTmpl.replace('LANG', lang).replace('code-widget">',
        getBgClass($pre[0]) + (enableCopy ? ' code-widget copy-btn" data-clipboard-snippet><i class="iconfont icon-copy"></i>' : ' code-widget">')));

      if (enableCopy) {
        Fluid.utils.createScript('https://lib.baomitu.com/clipboard.js/2.0.10/clipboard.min.js', function() {
          var clipboard = new window.ClipboardJS('.copy-btn', {
            target: function(trigger) {
              var nodes = trigger.parentNode.childNodes;
              for (var i = 0; i < nodes.length; i++) {
                if (nodes[i].tagName === 'CODE') {
                  return nodes[i];
                }
              }
            }
          });
          clipboard.on('success', function(e) {
            e.clearSelection();
            e.trigger.innerHTML = e.trigger.innerHTML.replace('icon-copy', 'icon-success');
            setTimeout(function() {
              e.trigger.innerHTML = e.trigger.innerHTML.replace('icon-success', 'icon-copy');
            }, 2000);
          });
        });
      }
    });
  })();
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>

  <script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>

  <!-- 樱花特效 -->
  <script type="text/javascript">
    var windowWidth = $(window).width();
    if (windowWidth > 480) {
      document.write('<script type="text/javascript" src="/js/sakura.js"><\/script>');
    }
  </script>

</body>
</html>
